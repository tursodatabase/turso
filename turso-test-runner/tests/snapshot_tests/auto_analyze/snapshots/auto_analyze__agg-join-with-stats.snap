---
source: auto_analyze.sqltest
expression: |-
  SELECT c.region, COUNT(*) as order_count, SUM(o.quantity) as total_qty
      FROM orders o
      JOIN customers c ON c.id = o.customer_id
      GROUP BY c.region;
info:
  statement_type: SELECT
  tables:
  - c.id
  - customers
  - orders
  setup_blocks:
  - schema
  - data
  - auto_analyze_warmup
  database: ':memory:'
---
QUERY PLAN
|--SEARCH o USING INDEX idx_orders_customer
`--SCAN customers AS c USING COVERING INDEX idx_customers_region

BYTECODE
addr  opcode                    p1  p2  p3  p4              p5  comment
   0          Init               0  45   0                   0  Start at 45
   1          Null               0   9  10                   0  r[9..10]=NULL
   2          Integer            0   6   0                   0  r[6]=0; clear group by abort flag
   3          Null               0   7   0                   0  r[7]=NULL; initialize group by comparison registers to NULL
   4          Gosub             14  41   0                   0  ; go to clear accumulator subroutine
   5          OpenRead           0   4   0  k(5,B,B,B,B,B)   0  table=orders, root=4, iDb=0
   6          OpenRead           1   6   0  k(2,B)           0  index=idx_orders_customer, root=6, iDb=0
   7          OpenRead           2  12   0  k(2,B)           0  index=idx_customers_region, root=12, iDb=0
   8          Rewind             2  28   0                   0  Rewind index idx_customers_region
   9            IdxRowId         2  15   0                   0  r[15]=cursor 2 for index idx_customers_region.rowid
  10            SeekGE           1  27  15                   0  key=[15..15]
  11              IdxGT          1  27  15                   0  key=[15..15]
  12              DeferredSeek   1   0   0                   0
  13              Column         2   0  12                   0  r[12]=idx_customers_region.region
  14              Column         0   3  13                   0  r[13]=orders.quantity
  15              Compare        7  12   1  k(1, Binary)     0  r[7..7]==r[12..12]
  16              Jump          17  21  17                   0  ; start new group if comparison is not equal
  17              Gosub          4  32   0                   0  ; check if ended group had data, and output if so
  18              Move          12   7   1                   0  r[7..7]=r[12..12]
  19              IfPos          6  44   0                   0  r[6]>0 -> r[6]-=0, goto 44; check abort flag
  20              Gosub         14  41   0                   0  ; goto clear accumulator subroutine
  21              AggStep        0  16   9  count            0  accum=r[9] step(r[16])
  22              AggStep        0  13  10  sum              0  accum=r[10] step(r[13])
  23              If             5  25   0                   0  if r[5] goto 25; don't emit group columns if continuing existing group
  24              Column         2   0   8                   0  r[8]=idx_customers_region.region
  25              Integer        1   5   0                   0  r[5]=1; indicate data in accumulator
  26            Next             1  11   0                   0
  27          Next               2   9   0                   0
  28          Gosub              4  32   0                   0  ; emit row for final group
  29          Goto               0  44   0                   0  ; group by finished
  30          Integer            1   6   0                   0  r[6]=1
  31        Return               4   0   0                   0
  32        IfPos                5  34   0                   0  r[5]>0 -> r[5]-=0, goto 34; output group by row subroutine start
  33      Return                 4   0   0                   0
  34      AggFinal               0   9   0  count            0  accum=r[9]
  35      AggFinal               0  10   0  sum              0  accum=r[10]
  36      Copy                   8   1   0                   0  r[1]=r[8]
  37      Copy                   9   2   0                   0  r[2]=r[9]
  38      Copy                  10   3   0                   0  r[3]=r[10]
  39      ResultRow              1   3   0                   0  output=r[1..3]
  40    Return                   4   0   0                   0
  41    Null                     0   8  10                   0  r[8..10]=NULL; clear accumulator subroutine start
  42    Integer                  0   5   0                   0  r[5]=0
  43  Return                    14   0   0                   0
  44  Halt                       0   0   0                   0
  45  Transaction                0   1  13                   0  iDb=0 tx_mode=Read
  46  Integer                    1  16   0                   0  r[16]=1
  47  Goto                       0   1   0                   0
