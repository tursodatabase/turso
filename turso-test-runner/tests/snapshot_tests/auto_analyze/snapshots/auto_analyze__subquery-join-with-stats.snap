---
source: auto_analyze.sqltest
expression: |-
  SELECT c.name, c.region
      FROM customers c
      WHERE c.id IN (
          SELECT DISTINCT o.customer_id
          FROM orders o
          JOIN order_items oi ON oi.order_id = o.id
          WHERE oi.quantity > 3
      );
info:
  statement_type: SELECT
  tables:
  - customers
  - oi.order_id
  - order_items
  - orders
  setup_blocks:
  - schema
  - data
  - auto_analyze_warmup
  database: ':memory:'
---
QUERY PLAN
|--SCAN orders AS o USING COVERING INDEX idx_orders_customer
|--SEARCH oi USING INDEX idx_items_order
`--SCAN customers AS c

BYTECODE
addr  opcode                    p1  p2  p3  p4              p5  comment
   0  Init                       0  44   0                   0  Start at 44
   1  Once                      20   0   0                   0  goto 20
   2  OpenEphemeral              0   0   0                   0  cursor=0 is_table=false
   3  HashClear         1073741824   0   0                   0
   4  OpenRead                   1   6   0  k(2,B)           0  index=idx_orders_customer, root=6, iDb=0
   5  OpenRead                   2   5   0  k(5,B,B,B,B,B)   0  table=order_items, root=5, iDb=0
   6  OpenRead                   3   9   0  k(2,B)           0  index=idx_items_order, root=9, iDb=0
   7  Rewind                     1  20   0                   0  Rewind index idx_orders_customer
   8    IdxRowId                 1   2   0                   0  r[2]=cursor 1 for index idx_orders_customer.rowid
   9    SeekGE                   3  19   2                   0  key=[2..2]
  10      IdxGT                  3  19   2                   0  key=[2..2]
  11      DeferredSeek           3   2   0                   0
  12      Column                 2   3   4                   0  r[4]=order_items.quantity
  13      Le                     4   5  18  Binary           0  if r[4]<=r[5] goto 18
  14      Column                 1   0   1                   0  r[1]=idx_orders_customer.customer_id
  15      HashDistinct  1073741824   1   1  jmp=18           0
  16      MakeRecord             1   1   6                   0  r[6]=mkrec(r[1..1]); for ephemeral_index_where_sub_t2
  17      IdxInsert              0   6   0                   8  key=r[6]
  18    Next                     3  10   0                   0
  19  Next                       1   8   0                   0
  20  OpenRead                   4   2   0  k(4,B,B,B,B)     0  table=customers, root=2, iDb=0
  21  Rewind                     4  43   0                   0  Rewind table customers
  22    Integer                  0   9   0                   0  r[9]=0
  23    RowId                    4  10   0                   0  r[10]=customers.rowid
  24    Affinity                10   1   0                   0  r[10..11] = D
  25    NotFound                 0  27  10                   0  if not found goto 27
  26    Goto                     0  33   0                   0
  27    Rewind                   0  35   0                   0  Rewind  ephemeral_index_where_sub_t2
  28      Column                 0   0  11                   0  r[11]=ephemeral_index_where_sub_t2.customer_id
  29      Ne                    10  11  31  Binary           0  if r[10]!=r[11] goto 31
  30      Goto                   0  37   0                   0
  31    Next                     0  28   0                   0
  32    Goto                     0  35   0                   0
  33    Integer                  1   9   0                   0  r[9]=1
  34    Goto                     0  38   0                   0
  35    Integer                  0   9   0                   0  r[9]=0
  36    Goto                     0  38   0                   0
  37    Null                     0   9   0                   0  r[9]=NULL
  38    IfNot                    9  42   1                   0  if !r[9] goto 42
  39    Column                   4   1   7                   0  r[7]=customers.name
  40    Column                   4   2   8                   0  r[8]=customers.region
  41    ResultRow                7   2   0                   0  output=r[7..8]
  42  Next                       4  22   0                   0
  43  Halt                       0   0   0                   0
  44  Transaction                0   1  13                   0  iDb=0 tx_mode=Read
  45  Integer                    3   5   0                   0  r[5]=3
  46  Goto                       0   1   0                   0
