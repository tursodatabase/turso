# CREATE TABLE Tests
# Ported from testing/create_table.test

@database :memory:

test create_table_one_unique_set {
    CREATE TABLE t4 (a, unique(b));
}
expect error {}

test create_table_same_uniques_and_primary_keys {
    CREATE TABLE t2 (a,b, unique(a,b), primary key(a,b));
}
expect {
}

test create_table_unique_contained_in_primary_keys {
    CREATE TABLE t4 (a,b, primary key(a,b), unique(a));
}
expect {
}

setup unique-constraint-autoinc {
    CREATE TABLE `databases` (`id` integer PRIMARY KEY AUTOINCREMENT,`created_at` datetime,`updated_at` datetime,`deleted_at` datetime,`hostname` text NOT NULL,`namespace` text,`address` text,`primary_address` text,`local` numeric,`allowed_ips` text, CONSTRAINT `uni_databases_hostname` UNIQUE (`hostname`));
}

@setup unique-constraint-autoinc
test create_table_unique_constraint_and_autoinc_backticks {
    SELECT 1;
}
expect {
    1
}

setup rowid-unique-regression {
    create table u(x integer unique primary key);
    insert into u values (1),(2),(3);
}

@setup rowid-unique-regression
test create_table_rowid_unique_regression_test {
    select * from u where x > 2;
}
expect {
    3
}

setup empty-string-name-table {
    create table ''('' INTEGER) strict;
    insert into '' values(9);
}

@setup empty-string-name-table
test create_table_with_empty_string_name {
    select * from '';
}
expect {
    9
}

test create_table_multiple_column_primary_keys {
    CREATE TABLE t(a primary key, b primary key);
}
expect error {}

test create_table_column_and_table_primary_keys {
    CREATE TABLE t(a primary key, b,c, primary key(b,c));
}
expect error {}

test create_table_multiple_table_primary_keys {
    CREATE TABLE t(a,b,c,d,primary key(a,b), primary key(c,d));
}
expect error {}

setup col-named-rowid {
    create table t(rowid, a);
    insert into t values (1,2), (2,3), (3,4);
    update t set rowid = 1;
}

@setup col-named-rowid
test col-named-rowid {
    select count(*) from t where rowid = 1;
}
expect {
    3
}

test create_table_duplicate_column_names {
    CREATE TABLE t(a, a);
}
expect error {}

test create_table_duplicate_column_names_case_insensitive {
    CREATE TABLE t(A, a);
}
expect error {}

test create_table_duplicate_column_names_quoted {
    CREATE TABLE t("a", a);
}
expect error {}

setup view-table-collision {
    CREATE VIEW v_same AS SELECT 1;
}

@setup view-table-collision
test create_table_view_collision-1 {
    CREATE TABLE v_same(x INT);
}
expect error {}

setup table-view-collision {
    CREATE TABLE t_same(x INT);
}

@setup table-view-collision
test create_view_table_collision-1 {
    CREATE VIEW t_same AS SELECT 1;
}
expect error {}

setup index-view-collision {
    CREATE VIEW i_same AS SELECT 1;
    CREATE TABLE t1(x);
}

@setup index-view-collision
test create_index_view_collision-1 {
    CREATE INDEX i_same ON t1(x);
}
expect error {}

setup index-table-collision {
    CREATE TABLE i_same(x INT);
    CREATE TABLE t2(y);
}

@setup index-table-collision
test create_index_table_collision-1 {
    CREATE INDEX i_same ON t2(y);
}
expect error {}

setup table-index-collision {
    CREATE TABLE t3(z);
    CREATE INDEX ix_same ON t3(z);
}

@setup table-index-collision
test create_table_index_collision-1 {
    CREATE TABLE ix_same(x INT);
}
expect error {}

setup view-index-collision {
    CREATE TABLE t4(w);
    CREATE INDEX ix_same ON t4(w);
}

@setup view-index-collision
test create_view_index_collision-1 {
    CREATE VIEW ix_same AS SELECT 1;
}
expect error {}

setup col-default-true {
    create table t(id integer primary key, a default true);
    insert into t (id) values (1);
}

@setup col-default-true
test col-default-true {
    SELECT a from t;
}
expect {
    1
}

setup col-default-false {
    create table t(id integer primary key, a default false);
    insert into t (id) values (1);
}

@setup col-default-false
test col-default-false {
    SELECT a from t;
}
expect {
    0
}

