# NULL Tests
# Ported from testing/null.test

@database :memory:

# Basic NULL tests (no setup needed)
test isnull {
    SELECT null isnull, 'hi' isnull;
}
expect {
    1|0
}

test is-null {
    SELECT null is null, 'hi' is null;
}
expect {
    1|0
}

test notnull {
    SELECT null notnull, 'hi' notnull;
}
expect {
    0|1
}

test not-null {
    SELECT null not null, 'hi' not null;
}
expect {
    0|1
}

test sel-true {
    SELECT true;
}
expect {
    1
}

test sel-false {
    SELECT false;
}
expect {
    0
}

# Setup blocks for NULL comparison tests
setup unique-table {
    CREATE TABLE t (a int, x int unique);
    INSERT INTO t(a) VALUES(1);
}

setup asc-index {
    CREATE TABLE t1(x);
    CREATE INDEX t1_idx ON t1(x ASC);
    INSERT INTO t1 VALUES (1), (2), (3);
}

setup desc-index {
    CREATE TABLE t2(x);
    CREATE INDEX t2_idx ON t2(x DESC);
    INSERT INTO t2 VALUES (1), (2), (3);
}

setup asc-index-t3 {
    CREATE TABLE t3(x);
    CREATE INDEX t3_idx ON t3(x ASC);
    INSERT INTO t3 VALUES (1), (2), (3);
}

setup desc-index-t4 {
    CREATE TABLE t4(x);
    CREATE INDEX t4_idx ON t4(x DESC);
    INSERT INTO t4 VALUES (1), (2), (3);
}

setup asc-index-t5 {
    CREATE TABLE t5(x);
    CREATE INDEX t5_idx ON t5(x ASC);
    INSERT INTO t5 VALUES (1), (2), (3);
}

setup desc-index-t6 {
    CREATE TABLE t6(x);
    CREATE INDEX t6_idx ON t6(x DESC);
    INSERT INTO t6 VALUES (1), (2), (3);
}

setup asc-index-t7 {
    CREATE TABLE t7(x);
    CREATE INDEX t7_idx ON t7(x ASC);
    INSERT INTO t7 VALUES (1), (2), (3);
}

setup desc-index-t8 {
    CREATE TABLE t8(x);
    CREATE INDEX t8_idx ON t8(x DESC);
    INSERT INTO t8 VALUES (1), (2), (3);
}

setup desc-index-t9 {
    CREATE TABLE t9(x);
    CREATE INDEX t9_idx ON t9(x DESC);
    INSERT INTO t9 VALUES (1), (2), (3);
}

# https://github.com/tursodatabase/turso/issues/3966
@setup unique-table
test not-null-just-cuz-unique {
    SELECT * FROM t;
}
expect {
    1|
}

# Regression tests for NULL comparison with index scans
# Any comparison with NULL should return 0 rows because NULL comparisons
# always return NULL (unknown), which is falsy.

@setup asc-index
test null-comparison-asc-gt {
    SELECT * FROM t1 WHERE x > NULL;
}
expect {
}

@setup desc-index
test null-comparison-desc-gt {
    SELECT * FROM t2 WHERE x > NULL;
}
expect {
}

@setup asc-index-t3
test null-comparison-asc-lt {
    SELECT * FROM t3 WHERE x < NULL;
}
expect {
}

@setup desc-index-t4
test null-comparison-desc-lt {
    SELECT * FROM t4 WHERE x < NULL;
}
expect {
}

@setup asc-index-t5
test null-comparison-asc-ge {
    SELECT * FROM t5 WHERE x >= NULL;
}
expect {
}

@setup desc-index-t6
test null-comparison-desc-ge {
    SELECT * FROM t6 WHERE x >= NULL;
}
expect {
}

@setup asc-index-t7
test null-comparison-asc-le {
    SELECT * FROM t7 WHERE x <= NULL;
}
expect {
}

@setup desc-index-t8
test null-comparison-desc-le {
    SELECT * FROM t8 WHERE x <= NULL;
}
expect {
}

@setup desc-index-t9
test null-comparison-desc-order-by {
    SELECT * FROM t9 WHERE x > NULL ORDER BY x DESC;
}
expect {
}
