# Window Function Tests (Memory)
# Ported from testing/window.test

@database :memory:

# Collate in partition by
setup window-collate-partition-by {
    CREATE TABLE fruits(name collate nocase);
    INSERT INTO fruits(name) VALUES ('Apple'), ('banana'), ('apple');
}

@setup window-collate-partition-by
test window-collate-partition-by {
    SELECT
        name,
        count(*) OVER (PARTITION BY name)
    FROM fruits;
}
expect {
    Apple|2
    apple|2
    banana|1
}

# Collate in order by
setup window-collate-order-by {
    CREATE TABLE fruits(name collate nocase);
    INSERT INTO fruits(name) VALUES ('Apple'),('banana'), ('apple');
}

@setup window-collate-order-by
test window-collate-order-by {
    SELECT
        name,
        count(*) OVER (ORDER BY name)
    FROM fruits;
}
expect {
    Apple|2
    apple|2
    banana|3
}
