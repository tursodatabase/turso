# ORDER BY Tests (Memory - standalone tests)
# Ported from testing/orderby.test

@database :memory:

setup t-table {
    CREATE TABLE t (a,b,c,d);
    INSERT INTO t VALUES (1,2,3,4),(2,3,4,5);
}

@setup t-table
test distinct_orderby_regression {
    SELECT DISTINCT c,b FROM t ORDER BY d,b;
}
expect {
    3|2
    4|3
}

setup t-xy-table {
    CREATE TABLE t(x,y);
    INSERT INTO t VALUES (1,200),(2,100);
}

@setup t-xy-table
test orderby_alias_precedence {
    SELECT x AS y, y AS x FROM t ORDER BY x;
}
expect {
    2|100
    1|200
}

setup t-xyz-table {
    CREATE TABLE t(x,y,z);
    INSERT INTO t VALUES (1,2,3),(1,2,6),(1,2,9),(1,2,10),(1,3,-1),(1,3,-2);
}

@setup t-xyz-table
test orderby_same_rows {
    SELECT x, y FROM t ORDER BY x, y LIMIT 10;
}
expect {
    1|2
    1|2
    1|2
    1|2
    1|3
    1|3
}

setup t-ab-table {
    CREATE TABLE t(a, b);
    INSERT INTO t VALUES (1, 1), (2, 2), (3, 3);
}

# https://github.com/tursodatabase/turso/issues/3684
@setup t-ab-table
test orderby_alias_shadows_column {
    SELECT a, -b AS a FROM t ORDER BY a;
}
expect {
    3|-3
    2|-2
    1|-1
}

setup ambiguous-tables {
    CREATE TABLE a(id INT, value INT);
    INSERT INTO a VALUES (1, 10), (2, 20);
    CREATE TABLE b(id INT, value INT);
    INSERT INTO b VALUES (1, 100), (2, 200);
}

@setup ambiguous-tables
test order_by_ambiguous_column {
    SELECT a.id, b.value FROM a JOIN b ON a.id = b.id ORDER BY value;
}
expect error {}
