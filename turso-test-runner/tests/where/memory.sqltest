# WHERE Tests (Memory)
# Ported from testing/where.test

@database :memory:

# Column aliases do not take precedence over columns in WHERE
setup where-alias-precedence {
    CREATE TABLE t(x,y);
    INSERT INTO t VALUES (1,200),(2,100);
}

@setup where-alias-precedence
test where-alias-precedence {
    SELECT x AS y, y AS x FROM t WHERE x = 100;
}
expect {
}

# More aliasing tests
setup where-alias-precedence-2 {
    CREATE TABLE t(x,y);
    INSERT INTO t SELECT value, value+100 FROM generate_series(1,3);
}

@setup where-alias-precedence-2
test where-alias-precedence-2 {
    SELECT x AS lol, y AS x FROM t WHERE x = 101;
}
expect {
}

# Alias in SELECT list can be used in WHERE (when not conflicting with column)
setup where-alias-precedence-3 {
    CREATE TABLE t(x,y);
    INSERT INTO t SELECT value, value+100 FROM generate_series(1,3);
}

@setup where-alias-precedence-3
test where-alias-precedence-3 {
    SELECT x AS lol, y AS lmao FROM t WHERE lmao = 101;
}
expect {
    1|101
}
