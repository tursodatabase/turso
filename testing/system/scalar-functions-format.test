#!/usr/bin/env tclsh

set testdir [file dirname $argv0]
source $testdir/tester.tcl

# Test format() as an alias for printf()
# format() was added in SQLite 3.38.0 as an alias for printf()

# Basic string formatting
do_execsql_test format-basic-string {
  SELECT format('Hello World!');
} {{Hello World!}}

do_execsql_test format-string-replacement {
  SELECT format('Hello, %s', 'Alice');
} {{Hello, Alice}}

do_execsql_test format-string-substitution {
  SELECT format('Hello, %s!', 'World');
} {{Hello, World!}}

do_execsql_test format-multiple-strings {
  SELECT format('%s %s!', 'Hello', 'World');
} {{Hello World!}}

do_execsql_test format-null-string {
  SELECT format('Hello, %s!', NULL);
} {{Hello, !}}

do_execsql_test format-integer-as-string {
  SELECT format('Value: %s', 42);
} {{Value: 42}}

do_execsql_test format-percent-escape {
  SELECT format('100%% complete');
} {{100% complete}}


# Integer formatting

do_execsql_test format-integer-replacement {
  SELECT format('Number: %d', 42);
} {{Number: 42}}

do_execsql_test format-integer-negative {
  SELECT format('Number: %d', -42);
} {{Number: -42}}

do_execsql_test format-integer-arithmetic-expression {
  SELECT format('%d + %d = %d', 2, 3, 5);
} {{2 + 3 = 5}}

do_execsql_test format-text-as-integer {
  SELECT format('Number: %d', 'not a number');
} {{Number: 0}}


# Unsigned integer formatting

do_execsql_test format-unsigned-basic {
  SELECT format('Number: %u', 42);
} {{Number: 42}}

do_execsql_test format-unsigned-arithmetic-expression {
  SELECT format('%u + %u = %u', 2, 3, 5);
} {{2 + 3 = 5}}

do_execsql_test format-unsigned-negative {
  SELECT format('Negative: %u', -1);
} {{Negative: 18446744073709551615}}

do_execsql_test format-text-as-unsigned {
  SELECT format('NaN: %u', 'not a number');
} {{NaN: 0}}


# Float formatting

do_execsql_test format-float-basic {
  SELECT format('Number: %f', 42.5);
} {{Number: 42.500000}}

do_execsql_test format-float-negative {
  SELECT format('Number: %f', -42.5);
} {{Number: -42.500000}}

do_execsql_test format-integer-as-float {
  SELECT format('Number: %f', 42);
} {{Number: 42.000000}}

do_execsql_test format-float-arithmetic {
  SELECT format('%f + %f = %f', 2.5, 3.5, 6.0);
} {{2.500000 + 3.500000 = 6.000000}}

do_execsql_test format-text-as-float {
  SELECT format('Number: %f', 'not a number');
} {{Number: 0.000000}}


# Character formatting

do_execsql_test format-char-single {
  SELECT format('character: %c', 'a');
} {{character: a}}

do_execsql_test format-char-first-from-string {
  SELECT format('character: %c', 'this is a test');
} {{character: t}}

do_execsql_test format-char-empty-string {
  SELECT format('character: %c', '');
} {{character: }}

do_execsql_test format-char-from-integer {
  SELECT format('character: %c', 123);
} {{character: 1}}

do_execsql_test format-char-from-float {
  SELECT format('character: %c', 42.5);
} {{character: 4}}


# Exponential notation formatting

do_execsql_test format-exp-large-number {
  SELECT format('Exp: %e', 23000000.0);
} {{Exp: 2.300000e+07}}

do_execsql_test format-exp-negative-large {
  SELECT format('Exp: %e', -23000000.0);
} {{Exp: -2.300000e+07}}

do_execsql_test format-exp-decimal-float {
  SELECT format('Exp: %e', 250.375);
} {{Exp: 2.503750e+02}}

do_execsql_test format-exp-small-positive {
  SELECT format('Exp: %e', 0.0003235);
} {{Exp: 3.235000e-04}}

do_execsql_test format-exp-zero {
  SELECT format('Exp: %e', 0.0);
} {{Exp: 0.000000e+00}}

do_execsql_test format-exp-string-integer {
  SELECT format('Exp: %e', '123');
} {{Exp: 1.230000e+02}}

do_execsql_test format-exp-string-float {
  SELECT format('Exp: %e', '123.45');
} {{Exp: 1.234500e+02}}

do_execsql_test format-exp-string-text {
  SELECT format('Exp: %e', 'test');
} {{Exp: 0.000000e+00}}


# Hexadecimal formatting

do_execsql_test format-hex-simple {
  SELECT format('hex: %x', 4);
} {{hex: 4}}

do_execsql_test format-hex-large-number {
  SELECT format('hex: %x', 15565303546);
} {{hex: 39fc3aefa}}

do_execsql_test format-hex-uppercase {
  SELECT format('hex: %X', 15565303546);
} {{hex: 39FC3AEFA}}

do_execsql_test format-hex-negative {
  SELECT format('hex: %x', -15565303546);
} {{hex: fffffffc603c5106}}

do_execsql_test format-hex-float {
  SELECT format('hex: %x', 42.5);
} {{hex: 2a}}


# Octal formatting

do_execsql_test format-octal-simple {
  SELECT format('octal: %o', 4);
} {{octal: 4}}

do_execsql_test format-octal-large-number {
  SELECT format('octal: %o', 15565303546);
} {{octal: 163760727372}}

do_execsql_test format-octal-negative {
  SELECT format('octal: %o', -15565303546);
} {{octal: 1777777777614017050406}}

do_execsql_test format-octal-float {
  SELECT format('octal: %o', 42.5);
} {{octal: 52}}


# Mixed formatting

do_execsql_test format-mixed-string-integer {
  SELECT format('%s: %d', 'Count', 42);
} {{Count: 42}}

do_execsql_test format-mixed-all-types {
  SELECT format('%s: %d (%f%%)', 'Progress', 75, 75.5);
} {{Progress: 75 (75.500000%)}}

do_execsql_test format-mixed-complex-format {
  SELECT format('Name: %s, ID: %d, Score: %f', 'John', 123, 95.5);
} {{Name: John, ID: 123, Score: 95.500000}}

do_execsql_test format-mixed-string-exponential {
  SELECT format('Scientific: %s = %e', 'Large number', 123000.0);
} {{Scientific: Large number = 1.230000e+05}}

do_execsql_test format-mixed-integer-octal {
  SELECT format('Decimal %d is octal %o', 64, 64);
} {{Decimal 64 is octal 100}}

do_execsql_test format-mixed-exponential-float {
  SELECT format('Scientific %e equals %f', 0.00123, 0.00123);
} {{Scientific 1.230000e-03 equals 0.001230}}

do_execsql_test format-mixed-octal-hex {
  SELECT format('Octal %o is hex %x', 255, 255);
} {{Octal 377 is hex ff}}


# Verify format() and printf() produce identical results

do_execsql_test format-equals-printf-string {
  SELECT format('Hello, %s!', 'World') = printf('Hello, %s!', 'World');
} {1}

do_execsql_test format-equals-printf-integer {
  SELECT format('Number: %d', 42) = printf('Number: %d', 42);
} {1}

do_execsql_test format-equals-printf-float {
  SELECT format('Value: %f', 3.14159) = printf('Value: %f', 3.14159);
} {1}

do_execsql_test format-equals-printf-mixed {
  SELECT format('%s: %d (%f)', 'Test', 123, 45.67) = printf('%s: %d (%f)', 'Test', 123, 45.67);
} {1}

do_execsql_test format-equals-printf-hex {
  SELECT format('0x%X', 255) = printf('0x%X', 255);
} {1}
