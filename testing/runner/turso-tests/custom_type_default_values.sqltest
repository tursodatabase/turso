@database :memory:
@requires-file custom_types "uses custom types"

@requires strict "uses STRICT tables"
test default-values-uses-type-default {
    CREATE TYPE cents BASE integer ENCODE value * 100 DECODE value / 100 DEFAULT 0;
    CREATE TABLE t1(id INTEGER PRIMARY KEY, amount cents, label TEXT DEFAULT 'x') STRICT;
    INSERT INTO t1 DEFAULT VALUES;
    SELECT id, amount, typeof(amount), label FROM t1;
}
expect {
    1|0|integer|x
}

@requires strict "uses STRICT tables"
test default-values-column-default-overrides-type-default {
    CREATE TYPE cents BASE integer ENCODE value * 100 DECODE value / 100 DEFAULT 0;
    CREATE TABLE t1(id INTEGER PRIMARY KEY, amount cents DEFAULT 99, label TEXT DEFAULT 'y') STRICT;
    INSERT INTO t1 DEFAULT VALUES;
    SELECT id, amount, label FROM t1;
}
expect {
    1|99|y
}

@requires strict "uses STRICT tables"
test default-values-matches-column-list-insert {
    CREATE TYPE cents BASE integer ENCODE value * 100 DECODE value / 100 DEFAULT 0;
    CREATE TABLE t1(id INTEGER PRIMARY KEY, amount cents, label TEXT DEFAULT 'x') STRICT;
    INSERT INTO t1(id, label) VALUES (1, 'a');
    INSERT INTO t1 DEFAULT VALUES;
    SELECT id, amount, label FROM t1 ORDER BY id;
}
expect {
    1|0|a
    2|0|x
}

@requires strict "uses STRICT tables"
test default-values-no-type-default-gives-null {
    CREATE TYPE simple BASE integer ENCODE value DECODE value;
    CREATE TABLE t1(id INTEGER PRIMARY KEY, val simple, label TEXT DEFAULT 'x') STRICT;
    INSERT INTO t1 DEFAULT VALUES;
    SELECT id, val, typeof(val), label FROM t1;
}
expect {
    1||null|x
}
