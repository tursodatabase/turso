@database :memory:

test total-changes-on-basic-insert {
    create table temp (t1 integer, primary key (t1));
    insert into temp values (1);
    select total_changes();
}
expect {
    1
}

test total-changes-on-multiple-row-insert {
    create table temp (t1 integer, primary key (t1));
    insert into temp values (1), (2), (3);
    select total_changes();
}
expect {
    3
}

test total-changes-on-multiple-inserts {
    create table temp (t1 integer, primary key (t1));
    insert into temp values (1), (2), (3);
    insert into temp values (4), (5), (6), (7);
    select total_changes();
}
expect {
    7
}

test total-changes-on-update-single-row {
    create table temp (t1 integer primary key, t2 text);
    insert into temp values (1, 'a'), (2, 'b'), (3, 'c');
    update temp set t2 = 'z' where t1 = 2;
    select total_changes();
}
expect {
    4
}

test total-changes-on-update-multiple-rows {
    create table temp (t1 integer primary key, t2 text);
    insert into temp values (1, 'a'), (2, 'b'), (3, 'c');
    update temp set t2 = 'x' where t1 > 1;
    select total_changes();
}
expect {
    5
}

test total-changes-on-update-no-match {
    create table temp (t1 integer primary key, t2 text);
    insert into temp values (1, 'a'), (2, 'b');
    update temp set t2 = 'y' where t1 = 99;
    select total_changes();
}
expect {
    2
}

test total-changes-on-delete {
    create table temp (t1 integer, primary key (t1));
    insert into temp values (1), (2), (3), (4), (5);
    delete from temp where t1 > 3;
    select total_changes();
}
expect {
    7
}

test total-changes-on-delete-all {
    create table temp (t1 integer, primary key (t1));
    insert into temp values (1), (2), (3);
    delete from temp;
    select total_changes();
}
expect {
    6
}

test total-changes-on-delete-no-match {
    create table temp (t1 integer, primary key (t1));
    insert into temp values (1), (2), (3);
    delete from temp where t1 > 100;
    select total_changes();
}
expect {
    3
}

test total-changes-mixed-operations {
    create table temp (t1 integer primary key, t2 text);
    insert into temp values (1, 'a'), (2, 'b'), (3, 'c');
    update temp set t2 = 'updated' where t1 <= 2;
    delete from temp where t1 = 3;
    select total_changes();
}
expect {
    6
}

