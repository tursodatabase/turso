@database :memory:

test window-collate-partition-by {
    CREATE TABLE fruits(name collate nocase);
    INSERT INTO fruits(name) VALUES ('Apple'), ('banana'), ('apple');
    SELECT
    name,
    count(*) OVER (PARTITION BY name)
    FROM fruits;
}
expect {
    Apple|2
    apple|2
    banana|1
}

test window-collate-order-by {
    CREATE TABLE fruits(name collate nocase);
    INSERT INTO fruits(name) VALUES ('Apple'),('banana'), ('apple');
    SELECT
    name,
    count(*) OVER (ORDER BY name)
    FROM fruits;
}
expect {
    Apple|2
    apple|2
    banana|3
}

test window-in-exists-subquery-referencing-outer-column {
    CREATE TABLE t1 (a);
    INSERT INTO t1 VALUES (1), (2), (3);
    SELECT * FROM (SELECT a FROM t1) as subq
    WHERE EXISTS (
      SELECT count(1) OVER (ORDER BY subq.a) FROM t1
    );
}
expect {
    1
    2
    3
}

