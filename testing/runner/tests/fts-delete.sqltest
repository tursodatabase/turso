@database :memory:

@backend cli
test fts-delete-where-match {
    CREATE TABLE t (id INTEGER PRIMARY KEY, x TEXT);
    CREATE INDEX t_idx ON t USING fts (x);
    INSERT INTO t VALUES (1, 'no');
    INSERT INTO t VALUES (2, 'ok');
    DELETE FROM t WHERE fts_match(x, 'ok');
    SELECT id, x FROM t ORDER BY id;
}
expect {
    1|no
}

@backend cli
test fts-update-where-match {
    CREATE TABLE t (id INTEGER PRIMARY KEY, x TEXT);
    CREATE INDEX t_idx ON t USING fts (x);
    INSERT INTO t VALUES (1, 'no');
    INSERT INTO t VALUES (2, 'ok');
    UPDATE t SET x = 'ok2' WHERE fts_match(x, 'ok');
    SELECT id, x FROM t ORDER BY id;
}
expect {
    1|no
    2|ok2
}
