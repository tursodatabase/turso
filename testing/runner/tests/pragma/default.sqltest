@database :default:
@database :default-no-rowidalias:

test pragma-table-info-equal-syntax {
    PRAGMA table_info=sqlite_schema
}
expect {
    0|type|TEXT|0||0
    1|name|TEXT|0||0
    2|tbl_name|TEXT|0||0
    3|rootpage|INT|0||0
    4|sql|TEXT|0||0
}

test pragma-table-info-call-syntax {
    PRAGMA table_info(sqlite_schema)
}
expect {
    0|type|TEXT|0||0
    1|name|TEXT|0||0
    2|tbl_name|TEXT|0||0
    3|rootpage|INT|0||0
    4|sql|TEXT|0||0
}

test pragma-table-xinfo-call-syntax {
    PRAGMA table_xinfo(sqlite_schema)
}
expect {
    0|type|TEXT|0||0|0
    1|name|TEXT|0||0|0
    2|tbl_name|TEXT|0||0|0
    3|rootpage|INT|0||0|0
    4|sql|TEXT|0||0|0
}

test pragma-table-xinfo-vtable {
    SELECT name, hidden FROM pragma_table_xinfo('generate_series')
}
expect {
    value|0
    start|1
    stop|1
    step|1
}

test pragma-table-info-alt-name-equal-syntax {
    PRAGMA table_info=sqlite_master
}
expect {
    0|type|TEXT|0||0
    1|name|TEXT|0||0
    2|tbl_name|TEXT|0||0
    3|rootpage|INT|0||0
    4|sql|TEXT|0||0
}

test pragma-table-info-alt-name-call-syntax {
    PRAGMA table_info(sqlite_master)
}
expect {
    0|type|TEXT|0||0
    1|name|TEXT|0||0
    2|tbl_name|TEXT|0||0
    3|rootpage|INT|0||0
    4|sql|TEXT|0||0
}

test pragma-function-table-info-alt-name {
    SELECT * FROM pragma_table_info('sqlite_master')
}
expect {
    0|type|TEXT|0||0
    1|name|TEXT|0||0
    2|tbl_name|TEXT|0||0
    3|rootpage|INT|0||0
    4|sql|TEXT|0||0
}

test pragma-function-table-info {
    SELECT * FROM pragma_table_info('sqlite_schema')
}
expect {
    0|type|TEXT|0||0
    1|name|TEXT|0||0
    2|tbl_name|TEXT|0||0
    3|rootpage|INT|0||0
    4|sql|TEXT|0||0
}

test pragma-vtab-table-info {
    SELECT * FROM pragma_table_info WHERE arg = 'sqlite_schema'
}
expect {
    0|type|TEXT|0||0
    1|name|TEXT|0||0
    2|tbl_name|TEXT|0||0
    3|rootpage|INT|0||0
    4|sql|TEXT|0||0
}

test pragma-table-info-invalid-table {
    PRAGMA table_info=pekka
}
expect {
}

test pragma-function-table-info-invalid-table {
    SELECT * FROM pragma_table_info('pekka')
}
expect {
}

test pragma-vtab-table-info-invalid-table {
    SELECT * FROM pragma_table_info WHERE arg = 'pekka'
}
expect {
}

test pragma-legacy-file-format {
    PRAGMA legacy_file_format
}
expect {
}

test pragma-function-legacy-file-format {
    SELECT * FROM pragma_legacy_file_format()
}
expect error {
    (no such table|Table.*not found)
}

test pragma-function-too-many-arguments {
    SELECT * FROM pragma_table_info('sqlite_schema', 'main', 'arg3')
}
expect error {
    Too many arguments
}

test pragma-function-update {
    SELECT * FROM pragma_wal_checkpoint()
}
expect error {
    (no such table|Table.*not found)
}

test pragma-function-nontext-argument {
    SELECT * FROM pragma_table_info('sqlite_schema', NULL);
}
expect {
    0|type|TEXT|0||0
    1|name|TEXT|0||0
    2|tbl_name|TEXT|0||0
    3|rootpage|INT|0||0
    4|sql|TEXT|0||0
}

test pragma-vtab-nontext-argument {
    SELECT * FROM pragma_table_info WHERE arg ='sqlite_schema' AND schema IS NULL;
}
expect {
    0|type|TEXT|0||0
    1|name|TEXT|0||0
    2|tbl_name|TEXT|0||0
    3|rootpage|INT|0||0
    4|sql|TEXT|0||0
}

test pragma-function-no-arguments {
    SELECT * FROM pragma_table_info();
}
expect {
}

test pragma-vtab-no-arguments {
    SELECT * FROM pragma_table_info;
}
expect {
}

@skip-if mvcc "panic: transaction should exist in txs map"
test pragma-vtab-join {
    SELECT s.name, ti.name FROM sqlite_schema AS s, pragma_table_info(s.name) AS ti;
}
expect {
    users|id
    users|first_name
    users|last_name
    users|email
    users|phone_number
    users|address
    users|city
    users|state
    users|zipcode
    users|age
    products|id
    products|name
    products|price
}

@skip-if mvcc "panic: transaction should exist in txs map"
test pragma-vtab-reversed-join-order {
    SELECT s.name, ti.name FROM pragma_table_info(s.name) AS ti, sqlite_schema AS s;
}
expect {
    users|id
    users|first_name
    users|last_name
    users|email
    users|phone_number
    users|address
    users|city
    users|state
    users|zipcode
    users|age
    products|id
    products|name
    products|price
}

test pragma-module-list-nonempty {
    SELECT * FROM pragma_module_list;
}
expect pattern {
    \ngenerate_series\n|^generate_series\n|\ngenerate_series$|^generate_series$
}

test pragma-temp-store {
		PRAGMA temp_store;
}
expect {
		0
}

test pragma-temp-store-set-memory {
		PRAGMA temp_store=MEMORY;
	    PRAGMA temp_store;
}
expect {
		2
}

test pragma-temp-store-set-file {
		PRAGMA temp_store=FILE;
	    PRAGMA temp_store;
}
expect {
		1
}

test pragma-function-list-has-abs {
    SELECT name, builtin, type, enc, narg, flags FROM pragma_function_list WHERE name = 'abs';
}
expect {
    abs|1|s|utf8|1|2099200
}

test pragma-function-list-has-count {
    SELECT name, builtin, type, narg FROM pragma_function_list WHERE name = 'count' ORDER BY narg;
}
expect {
    count|1|w|0
    count|1|w|1
}

test pragma-function-list-scalar {
    SELECT name, builtin, type, enc, narg, flags FROM pragma_function_list WHERE name = 'upper';
}
expect {
    upper|1|s|utf8|1|2099200
}

test pragma-function-list-aggregate {
    SELECT name, type, narg FROM pragma_function_list WHERE name = 'avg';
}
expect {
    avg|w|1
}
