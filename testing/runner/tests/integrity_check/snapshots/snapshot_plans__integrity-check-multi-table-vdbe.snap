---
source: snapshot_plans.sqltest
expression: PRAGMA integrity_check;
info:
  statement_type: OTHER
  setup_blocks:
  - schema_multi_table
  database: ':memory:'
---
QUERY PLAN


BYTECODE
addr  opcode        p1   p2   p3  p4                                       p5  comment
   0  Init           0  215    0                                            0  Start at 215
   1  Integer       99    2    0                                            0  r[2]=99
   2  Integer        0    3    0                                            0  r[3]=0
   3  IntegrityCk  100    0    0                                            0  roots=[5, 7, 6, 2, 4, 3, 1] message_register=4
   4  IsNull         4   11    0                                            0  if (r[4]==NULL) goto 11
   5  String8        0    5    0  *** in database main ***
                 0  r[5]='*** in database main ***
'
   6  Concat         4    5    4                                            0  r[4]=r[5] + r[4]
   7  Integer        1    3    0                                            0  r[3]=1
   8  ResultRow      4    1    0                                            0  output=r[4]
   9  IfPos          2   11    1                                            0  r[2]>0 -> r[2]-=1, goto 11
  10  Halt           0    0    0                                            0
  11  OpenRead       0    5    0  k(3,B,B,B)                                0  table=t2, root=5, iDb=0
  12  OpenRead       1    7    0  k(2,B)                                    0  =idx_t2_expr, root=7, iDb=0
  13  Integer        0    6    0                                            0  r[6]=0
  14  OpenRead       2    6    0  k(2,B)                                    0  =idx_t2_y, root=6, iDb=0
  15  Integer        0    7    0                                            0  r[7]=0
  16  Integer        0    8    0                                            0  r[8]=0
  17  Rewind         0   91    0                                            0  Rewind table t2
  18    AddImm       8    1    0                                            0  r[8]=r[8]+1
  19    Column       0    1    9                                            0  r[9]=t2.y
  20    NotNull      9   26    0                                            0  r[9]!=NULL -> goto 26
  21    String8      0    4    0  NULL value in t2.y                        0  r[4]='NULL value in t2.y'
  22    Integer      1    3    0                                            0  r[3]=1
  23    ResultRow    4    1    0                                            0  output=r[4]
  24    IfPos        2   26    1                                            0  r[2]>0 -> r[2]-=1, goto 26
  25    Halt         0    0    0                                            0
  26    Column       0    2   11                                            0  r[11]=t2.z
  27    Gt          11   12   33  Binary                                    0  if r[11]>r[12] goto 33
  28    String8      0    4    0  CHECK constraint failed in t2             0  r[4]='CHECK constraint failed in t2'
  29    Integer      1    3    0                                            0  r[3]=1
  30    ResultRow    4    1    0                                            0  output=r[4]
  31    IfPos        2   33    1                                            0  r[2]>0 -> r[2]-=1, goto 33
  32    Halt         0    0    0                                            0
  33    AddImm       6    1    0                                            0  r[6]=r[6]+1
  34    Column       0    1   15                                            0  r[15]=t2.y
  35    Function     0   15   13  lower                                     0  r[13]=func(r[15])
  36    RowId        0   14    0                                            0  r[14]=t2.rowid
  37    Affinity    13    1    0                                            0  r[13..14] = A
  38    Found        1   50   13                                            0  if found goto 50
  39    String8      0    4    0  row                                       0  r[4]='row '
  40    Concat       8    4    4                                            0  r[4]=r[4] + r[8]
  41    String8      0    5    0   missing from index                       0  r[5]=' missing from index '
  42    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
  43    String8      0    5    0  idx_t2_expr                               0  r[5]='idx_t2_expr'
  44    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
  45    Integer      1    3    0                                            0  r[3]=1
  46    ResultRow    4    1    0                                            0  output=r[4]
  47    IfPos        2   49    1                                            0  r[2]>0 -> r[2]-=1, goto 49
  48    Halt         0    0    0                                            0
  49    Goto         0   62    0                                            0
  50    IdxRowId     1   16    0                                            0  r[16]=cursor 1.rowid
  51    Eq          16   14   62                                            0  if r[16]==r[14] goto 62
  52    String8      0    4    0  rowid not at end-of-record for row        0  r[4]='rowid not at end-of-record for row '
  53    Concat       8    4    4                                            0  r[4]=r[4] + r[8]
  54    String8      0    5    0   of index                                 0  r[5]=' of index '
  55    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
  56    String8      0    5    0  idx_t2_expr                               0  r[5]='idx_t2_expr'
  57    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
  58    Integer      1    3    0                                            0  r[3]=1
  59    ResultRow    4    1    0                                            0  output=r[4]
  60    IfPos        2   62    1                                            0  r[2]>0 -> r[2]-=1, goto 62
  61    Halt         0    0    0                                            0
  62    AddImm       7    1    0                                            0  r[7]=r[7]+1
  63    Column       0    1   17                                            0  r[17]=t2.y
  64    RowId        0   18    0                                            0  r[18]=t2.rowid
  65    Affinity    17    1    0                                            0  r[17..18] = B
  66    Found        2   78   17                                            0  if found goto 78
  67    String8      0    4    0  row                                       0  r[4]='row '
  68    Concat       8    4    4                                            0  r[4]=r[4] + r[8]
  69    String8      0    5    0   missing from index                       0  r[5]=' missing from index '
  70    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
  71    String8      0    5    0  idx_t2_y                                  0  r[5]='idx_t2_y'
  72    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
  73    Integer      1    3    0                                            0  r[3]=1
  74    ResultRow    4    1    0                                            0  output=r[4]
  75    IfPos        2   77    1                                            0  r[2]>0 -> r[2]-=1, goto 77
  76    Halt         0    0    0                                            0
  77    Goto         0   90    0                                            0
  78    IdxRowId     2   19    0                                            0  r[19]=cursor 2.rowid
  79    Eq          19   18   90                                            0  if r[19]==r[18] goto 90
  80    String8      0    4    0  rowid not at end-of-record for row        0  r[4]='rowid not at end-of-record for row '
  81    Concat       8    4    4                                            0  r[4]=r[4] + r[8]
  82    String8      0    5    0   of index                                 0  r[5]=' of index '
  83    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
  84    String8      0    5    0  idx_t2_y                                  0  r[5]='idx_t2_y'
  85    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
  86    Integer      1    3    0                                            0  r[3]=1
  87    ResultRow    4    1    0                                            0  output=r[4]
  88    IfPos        2   90    1                                            0  r[2]>0 -> r[2]-=1, goto 90
  89    Halt         0    0    0                                            0
  90  Next           0   18    0                                            0
  91  Count          1   20    0                                            0
  92  Eq            20    6   98                                            0  if r[20]==r[6] goto 98
  93  String8        0    4    0  wrong # of entries in index idx_t2_expr   0  r[4]='wrong # of entries in index idx_t2_expr'
  94  Integer        1    3    0                                            0  r[3]=1
  95  ResultRow      4    1    0                                            0  output=r[4]
  96  IfPos          2   98    1                                            0  r[2]>0 -> r[2]-=1, goto 98
  97  Halt           0    0    0                                            0
  98  Close          1    0    0                                            0
  99  Count          2   21    0                                            0
 100  Eq            21    7  106                                            0  if r[21]==r[7] goto 106
 101  String8        0    4    0  wrong # of entries in index idx_t2_y      0  r[4]='wrong # of entries in index idx_t2_y'
 102  Integer        1    3    0                                            0  r[3]=1
 103  ResultRow      4    1    0                                            0  output=r[4]
 104  IfPos          2  106    1                                            0  r[2]>0 -> r[2]-=1, goto 106
 105  Halt           0    0    0                                            0
 106  Close          2    0    0                                            0
 107  Close          0    0    0                                            0
 108  OpenRead       3    2    0  k(2,B,B)                                  0  table=t1, root=2, iDb=0
 109  OpenRead       4    4    0  k(2,B)                                    0  =idx_t1_b_u, root=4, iDb=0
 110  Integer        0   22    0                                            0  r[22]=0
 111  OpenRead       5    3    0  k(2,B)                                    0  =idx_t1_b, root=3, iDb=0
 112  Integer        0   23    0                                            0  r[23]=0
 113  Integer        0   24    0                                            0  r[24]=0
 114  Rewind         3  188    0                                            0  Rewind table t1
 115    AddImm      24    1    0                                            0  r[24]=r[24]+1
 116    Column       3    1   25                                            0  r[25]=t1.b
 117    NotNull     25  123    0                                            0  r[25]!=NULL -> goto 123
 118    String8      0    4    0  NULL value in t1.b                        0  r[4]='NULL value in t1.b'
 119    Integer      1    3    0                                            0  r[3]=1
 120    ResultRow    4    1    0                                            0  output=r[4]
 121    IfPos        2  123    1                                            0  r[2]>0 -> r[2]-=1, goto 123
 122    Halt         0    0    0                                            0
 123    AddImm      22    1    0                                            0  r[22]=r[22]+1
 124    Column       3    1   26                                            0  r[26]=t1.b
 125    RowId        3   27    0                                            0  r[27]=t1.rowid
 126    Affinity    26    1    0                                            0  r[26..27] = B
 127    Found        4  139   26                                            0  if found goto 139
 128    String8      0    4    0  row                                       0  r[4]='row '
 129    Concat      24    4    4                                            0  r[4]=r[4] + r[24]
 130    String8      0    5    0   missing from index                       0  r[5]=' missing from index '
 131    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
 132    String8      0    5    0  idx_t1_b_u                                0  r[5]='idx_t1_b_u'
 133    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
 134    Integer      1    3    0                                            0  r[3]=1
 135    ResultRow    4    1    0                                            0  output=r[4]
 136    IfPos        2  138    1                                            0  r[2]>0 -> r[2]-=1, goto 138
 137    Halt         0    0    0                                            0
 138    Goto         0  151    0                                            0
 139    IdxRowId     4   28    0                                            0  r[28]=cursor 4.rowid
 140    Eq          28   27  151                                            0  if r[28]==r[27] goto 151
 141    String8      0    4    0  rowid not at end-of-record for row        0  r[4]='rowid not at end-of-record for row '
 142    Concat      24    4    4                                            0  r[4]=r[4] + r[24]
 143    String8      0    5    0   of index                                 0  r[5]=' of index '
 144    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
 145    String8      0    5    0  idx_t1_b_u                                0  r[5]='idx_t1_b_u'
 146    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
 147    Integer      1    3    0                                            0  r[3]=1
 148    ResultRow    4    1    0                                            0  output=r[4]
 149    IfPos        2  151    1                                            0  r[2]>0 -> r[2]-=1, goto 151
 150    Halt         0    0    0                                            0
 151    Next         4  153    0                                            0
 152    Goto         0  159    0                                            0
 153    IdxGT        4  159   26                                            0  key=[26..26]
 154    String8      0    4    0  non-unique entry in index idx_t1_b_u      0  r[4]='non-unique entry in index idx_t1_b_u'
 155    Integer      1    3    0                                            0  r[3]=1
 156    ResultRow    4    1    0                                            0  output=r[4]
 157    IfPos        2  159    1                                            0  r[2]>0 -> r[2]-=1, goto 159
 158    Halt         0    0    0                                            0
 159    AddImm      23    1    0                                            0  r[23]=r[23]+1
 160    Column       3    1   29                                            0  r[29]=t1.b
 161    RowId        3   30    0                                            0  r[30]=t1.rowid
 162    Affinity    29    1    0                                            0  r[29..30] = B
 163    Found        5  175   29                                            0  if found goto 175
 164    String8      0    4    0  row                                       0  r[4]='row '
 165    Concat      24    4    4                                            0  r[4]=r[4] + r[24]
 166    String8      0    5    0   missing from index                       0  r[5]=' missing from index '
 167    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
 168    String8      0    5    0  idx_t1_b                                  0  r[5]='idx_t1_b'
 169    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
 170    Integer      1    3    0                                            0  r[3]=1
 171    ResultRow    4    1    0                                            0  output=r[4]
 172    IfPos        2  174    1                                            0  r[2]>0 -> r[2]-=1, goto 174
 173    Halt         0    0    0                                            0
 174    Goto         0  187    0                                            0
 175    IdxRowId     5   31    0                                            0  r[31]=cursor 5.rowid
 176    Eq          31   30  187                                            0  if r[31]==r[30] goto 187
 177    String8      0    4    0  rowid not at end-of-record for row        0  r[4]='rowid not at end-of-record for row '
 178    Concat      24    4    4                                            0  r[4]=r[4] + r[24]
 179    String8      0    5    0   of index                                 0  r[5]=' of index '
 180    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
 181    String8      0    5    0  idx_t1_b                                  0  r[5]='idx_t1_b'
 182    Concat       5    4    4                                            0  r[4]=r[4] + r[5]
 183    Integer      1    3    0                                            0  r[3]=1
 184    ResultRow    4    1    0                                            0  output=r[4]
 185    IfPos        2  187    1                                            0  r[2]>0 -> r[2]-=1, goto 187
 186    Halt         0    0    0                                            0
 187  Next           3  115    0                                            0
 188  Count          4   32    0                                            0
 189  Eq            32   22  195                                            0  if r[32]==r[22] goto 195
 190  String8        0    4    0  wrong # of entries in index idx_t1_b_u    0  r[4]='wrong # of entries in index idx_t1_b_u'
 191  Integer        1    3    0                                            0  r[3]=1
 192  ResultRow      4    1    0                                            0  output=r[4]
 193  IfPos          2  195    1                                            0  r[2]>0 -> r[2]-=1, goto 195
 194  Halt           0    0    0                                            0
 195  Close          4    0    0                                            0
 196  Count          5   33    0                                            0
 197  Eq            33   23  203                                            0  if r[33]==r[23] goto 203
 198  String8        0    4    0  wrong # of entries in index idx_t1_b      0  r[4]='wrong # of entries in index idx_t1_b'
 199  Integer        1    3    0                                            0  r[3]=1
 200  ResultRow      4    1    0                                            0  output=r[4]
 201  IfPos          2  203    1                                            0  r[2]>0 -> r[2]-=1, goto 203
 202  Halt           0    0    0                                            0
 203  Close          5    0    0                                            0
 204  Close          3    0    0                                            0
 205  OpenRead       6    1    0  k(6,B,B,B,B,B)                            0  table=sqlite_schema, root=1, iDb=0
 206  Integer        0   34    0                                            0  r[34]=0
 207  Rewind         6  210    0                                            0  Rewind table sqlite_schema
 208    AddImm      34    1    0                                            0  r[34]=r[34]+1
 209  Next           6  208    0                                            0
 210  Close          6    0    0                                            0
 211  If             3  214    0                                            0  if r[3] goto 214
 212  String8        0    4    0  ok                                        0  r[4]='ok'
 213  ResultRow      4    1    0                                            0  output=r[4]
 214  Halt           0    0    0                                            0
 215  Transaction    0    1    6                                            0  iDb=0 tx_mode=Read
 216  Integer        0   12    0                                            0  r[12]=0
 217  Goto           0    1    0                                            0
