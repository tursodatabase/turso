---
source: joins.sqltest
expression: |-
  SELECT
          c.name,
          COUNT(o.order_id) AS order_count
      FROM
          customers c
      INNER JOIN orders o ON c.customer_id = o.customer_id
      WHERE
          c.customer_id BETWEEN 10 AND 20
      GROUP BY
          c.customer_id, c.name;
info:
  statement_type: SELECT
  tables:
  - c.customer_id
  - customers
  - orders
  setup_blocks:
  - schema
  database: ':memory:'
---
QUERY PLAN
|--MULTI-INDEX AND c (PRIMARY KEY, PRIMARY KEY)
`--SEARCH o USING INDEX idx_orders_customer_id

BYTECODE
addr  opcode                    p1  p2  p3  p4                    p5  comment
   0          Init               0  68   0                         0  Start at 68
   1          Null               0  10   0                         0  r[10]=NULL
   2          SorterOpen         0   3   0  k(2,B,B)               0  cursor=0
   3          Integer            0   5   0                         0  r[5]=0; clear group by abort flag
   4          Null               0   6   7                         0  r[6..7]=NULL; initialize group by comparison registers to NULL
   5          Gosub             15  64   0                         0  ; go to clear accumulator subroutine
   6          OpenRead           2   2   0  k(5,B,B,B,B,B)         0  table=customers, root=2, iDb=0
   7          OpenRead           3   8   0  k(2,B)                 0  index=idx_orders_customer_id, root=8, iDb=0
   8          Null               0  17   0                         0  r[17]=NULL
   9          Null               0  18   0                         0  r[18]=NULL
  10          Integer           10  19   0                         0  r[19]=10
  11          SeekGE             2  15  19                         0  key=[19..19]
  12            RowId            2  16   0                         0  r[16]=customers.rowid
  13            RowSetAdd       17  16   0                         0
  14          Next               2  12   0                         0
  15          Rewind             2  24   0                         0  Rewind table customers
  16          Integer           20  20   0                         0  r[20]=20
  17            RowId            2  21   0                         0  r[21]=customers.rowid
  18            Gt              21  20  24                         0  if r[21]>r[20] goto 24
  19            RowId            2  16   0                         0  r[16]=customers.rowid
  20            RowSetTest      17  22  16  -1                     0
  21            Goto             0  23   0                         0
  22            RowSetAdd       18  16   0                         0
  23          Next               2  17   0                         0
  24            RowSetRead      18  36  16                         0
  25            SeekRowid        2  16  26                         0  if (r[16]!=cursor 2 for table customers.rowid) goto 26
  26            RowId            2  22   0                         0  r[22]=customers.rowid
  27            SeekGE           3  35  22                         0  key=[22..22]
  28              IdxGT          3  35  22                         0  key=[22..22]
  29              RowId          2  12   0                         0  r[12]=customers.rowid
  30              Column         2   1  13                         0  r[13]=customers.name
  31              IdxRowId       3  14   0                         0  r[14]=cursor 3 for index idx_orders_customer_id.rowid
  32              MakeRecord    12   3  11                         0  r[11]=mkrec(r[12..14])
  33              SorterInsert   0  11   0  0                      0  key=r[11]
  34            Next             3  28   0                         0
  35          Goto               0  24   0                         0
  36          OpenPseudo         1  11   3                         0  3 columns in r[11]
  37          SorterSort         0  53   0                         0
  38            SorterData       0  11   1                         0  r[11]=data
  39            Column           1   0  23                         0  r[23]=pseudo.column 0
  40            Column           1   1  24                         0  r[24]=pseudo.column 1
  41            Compare          6  23   2  k(2, Binary, Binary)   0  r[6..7]==r[23..24]
  42            Jump            43  47  43                         0  ; start new group if comparison is not equal
  43            Gosub            3  57   0                         0  ; check if ended group had data, and output if so
  44            Move            23   6   2                         0  r[6..7]=r[23..24]
  45            IfPos            5  67   0                         0  r[5]>0 -> r[5]-=0, goto 67; check abort flag
  46            Gosub           15  64   0                         0  ; goto clear accumulator subroutine
  47            Column           1   2  25                         0  r[25]=pseudo.column 2
  48            AggStep          0  25  10  count                  0  accum=r[10] step(r[25])
  49            If               4  51   0                         0  if r[4] goto 51; don't emit group columns if continuing existing group
  50            Column           1   1   8                         0  r[8]=pseudo.column 1
  51            Integer          1   4   0                         0  r[4]=1; indicate data in accumulator
  52          SorterNext         0  38   0                         0
  53          Gosub              3  57   0                         0  ; emit row for final group
  54          Goto               0  67   0                         0  ; group by finished
  55          Integer            1   5   0                         0  r[5]=1
  56        Return               3   0   0                         0
  57        IfPos                4  59   0                         0  r[4]>0 -> r[4]-=0, goto 59; output group by row subroutine start
  58      Return                 3   0   0                         0
  59      AggFinal               0  10   0  count                  0  accum=r[10]
  60      Copy                   8   1   0                         0  r[1]=r[8]
  61      Copy                  10   2   0                         0  r[2]=r[10]
  62      ResultRow              1   2   0                         0  output=r[1..2]
  63    Return                   3   0   0                         0
  64    Null                     0   8  10                         0  r[8..10]=NULL; clear accumulator subroutine start
  65    Integer                  0   4   0                         0  r[4]=0
  66  Return                    15   0   0                         0
  67  Halt                       0   0   0                         0
  68  Transaction                0   1  10                         0  iDb=0 tx_mode=Read
  69  Goto                       0   1   0                         0
