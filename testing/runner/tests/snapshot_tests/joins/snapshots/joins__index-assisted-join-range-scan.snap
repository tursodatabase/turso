---
source: joins.sqltest
expression: |-
  SELECT
          c.name,
          COUNT(o.order_id) AS order_count
      FROM
          customers c
      INNER JOIN orders o ON c.customer_id = o.customer_id
      WHERE
          c.customer_id BETWEEN 10 AND 20
      GROUP BY
          c.customer_id, c.name;
info:
  statement_type: SELECT
  tables:
  - c.customer_id
  - customers
  - orders
  setup_blocks:
  - schema
  database: ':memory:'
---
QUERY PLAN
|--SCAN customers AS c
`--SEARCH o USING INDEX idx_orders_customer_id

BYTECODE
addr  opcode                    p1  p2  p3  p4                    p5  comment
   0          Init               0  54   0                         0  Start at 54
   1          Null               0  10   0                         0  r[10]=NULL
   2          SorterOpen         0   3   0  k(2,B,B)               0  cursor=0
   3          Integer            0   5   0                         0  r[5]=0; clear group by abort flag
   4          Null               0   6   7                         0  r[6..7]=NULL; initialize group by comparison registers to NULL
   5          Gosub             15  50   0                         0  ; go to clear accumulator subroutine
   6          OpenRead           2   2   0  k(5,B,B,B,B,B)         0  table=customers, root=2, iDb=0
   7          OpenRead           3   8   0  k(2,B)                 0  index=idx_orders_customer_id, root=8, iDb=0
   8          Rewind             2  22   0                         0  Rewind table customers
   9            RowId            2  16   0                         0  r[16]=customers.rowid
  10            Gt              17  16  21  Binary                 0  if r[17]>r[16] goto 21
  11            Gt              16  18  21  Binary                 0  if r[16]>r[18] goto 21
  12            RowId            2  19   0                         0  r[19]=customers.rowid
  13            SeekGE           3  21  19                         0  key=[19..19]
  14              IdxGT          3  21  19                         0  key=[19..19]
  15              RowId          2  12   0                         0  r[12]=customers.rowid
  16              Column         2   1  13                         0  r[13]=customers.name
  17              IdxRowId       3  14   0                         0  r[14]=cursor 3 for index idx_orders_customer_id.rowid
  18              MakeRecord    12   3  11                         0  r[11]=mkrec(r[12..14])
  19              SorterInsert   0  11   0  0                      0  key=r[11]
  20            Next             3  14   0                         0
  21          Next               2   9   0                         0
  22          OpenPseudo         1  11   3                         0  3 columns in r[11]
  23          SorterSort         0  39   0                         0
  24            SorterData       0  11   1                         0  r[11]=data
  25            Column           1   0  20                         0  r[20]=pseudo.column 0
  26            Column           1   1  21                         0  r[21]=pseudo.column 1
  27            Compare          6  20   2  k(2, Binary, Binary)   0  r[6..7]==r[20..21]
  28            Jump            29  33  29                         0  ; start new group if comparison is not equal
  29            Gosub            3  43   0                         0  ; check if ended group had data, and output if so
  30            Move            20   6   2                         0  r[6..7]=r[20..21]
  31            IfPos            5  53   0                         0  r[5]>0 -> r[5]-=0, goto 53; check abort flag
  32            Gosub           15  50   0                         0  ; goto clear accumulator subroutine
  33            Column           1   2  22                         0  r[22]=pseudo.column 2
  34            AggStep          0  22  10  count                  0  accum=r[10] step(r[22])
  35            If               4  37   0                         0  if r[4] goto 37; don't emit group columns if continuing existing group
  36            Column           1   1   8                         0  r[8]=pseudo.column 1
  37            Integer          1   4   0                         0  r[4]=1; indicate data in accumulator
  38          SorterNext         0  24   0                         0
  39          Gosub              3  43   0                         0  ; emit row for final group
  40          Goto               0  53   0                         0  ; group by finished
  41          Integer            1   5   0                         0  r[5]=1
  42        Return               3   0   0                         0
  43        IfPos                4  45   0                         0  r[4]>0 -> r[4]-=0, goto 45; output group by row subroutine start
  44      Return                 3   0   0                         0
  45      AggFinal               0  10   0  count                  0  accum=r[10]
  46      Copy                   8   1   0                         0  r[1]=r[8]
  47      Copy                  10   2   0                         0  r[2]=r[10]
  48      ResultRow              1   2   0                         0  output=r[1..2]
  49    Return                   3   0   0                         0
  50    Null                     0   8  10                         0  r[8..10]=NULL; clear accumulator subroutine start
  51    Integer                  0   4   0                         0  r[4]=0
  52  Return                    15   0   0                         0
  53  Halt                       0   0   0                         0
  54  Transaction                0   1  10                         0  iDb=0 tx_mode=Read
  55  Integer                   10  17   0                         0  r[17]=10
  56  Integer                   20  18   0                         0  r[18]=20
  57  Goto                       0   1   0                         0
