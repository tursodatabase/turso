---
source: joins.sqltest
expression: "SELECT\n        c.name,\n        o.order_id,\n        o.order_date,\n        p.name AS product_name,\n        p.category\n    FROM\n        customers c,\n        orders o,\n        order_items oi,\n        products p\n    WHERE\n        c.customer_id = o.customer_id\n        AND o.order_id = oi.order_id\n        AND oi.product_id = p.product_id\n        AND c.city = 'New York'\n        AND o.order_date >= '2024-01-01'\n        AND p.price > 50\n    ORDER BY\n        o.order_date DESC,\n        p.name;"
info:
  statement_type: SELECT
  tables:
    - customers
  setup_blocks:
    - schema
  database: ":memory:"
---
QUERY PLAN
|--SCAN customers AS c
|--SEARCH o USING INDEX idx_orders_customer_id
|--SEARCH oi USING INDEX idx_order_items_order_id
|--SEARCH p USING INTEGER PRIMARY KEY (rowid=?)
`--USE TEMP B-TREE FOR ORDER BY

BYTECODE
addr  opcode              p1  p2  p3  p4              p5  comment
   0  Init                 0  46   0                   0  Start at 46
   1  SorterOpen           0   2   0  k(2,-B,B)        0  cursor=0
   2  OpenRead             1   2   0  k(5,B,B,B,B,B)   0  table=customers, root=2, iDb=0
   3  OpenRead             2   4   0  k(5,B,B,B,B,B)   0  table=orders, root=4, iDb=0
   4  OpenRead             3   8   0  k(2,B)           0  index=idx_orders_customer_id, root=8, iDb=0
   5  OpenRead             4   5   0  k(5,B,B,B,B,B)   0  table=order_items, root=5, iDb=0
   6  OpenRead             5   9   0  k(2,B)           0  index=idx_order_items_order_id, root=9, iDb=0
   7  OpenRead             6   3   0  k(5,B,B,B,B,B)   0  table=products, root=3, iDb=0
   8  Rewind               1  35   0                   0  Rewind table customers
   9    Column             1   3   8                   0  r[8]=customers.city
  10    Ne                 8   9  34  Binary           0  if r[8]!=r[9] goto 34
  11    RowId              1  10   0                   0  r[10]=customers.rowid
  12    SeekGE             3  34  10                   0  key=[10..10]
  13      IdxGT            3  34  10                   0  key=[10..10]
  14      DeferredSeek     3   2   0                   0
  15      Column           2   2  12                   0  r[12]=orders.order_date
  16      Lt              12  13  33  Binary           0  if r[12]<r[13] goto 33
  17      IdxRowId         3  14   0                   0  r[14]=cursor 3 for index idx_orders_customer_id.rowid
  18      SeekGE           5  33  14                   0  key=[14..14]
  19        IdxGT          5  33  14                   0  key=[14..14]
  20        DeferredSeek   5   4   0                   0
  21        Column         4   2  15                   0  r[15]=order_items.product_id
  22        SeekRowid      6  15  32                   0  if (r[15]!=cursor 6 for table products.rowid) goto 32
  23        Column         6   3  17                   0  r[17]=products.price
  24        Le            17  18  32  Binary           0  if r[17]<=r[18] goto 32
  25        Column         2   2  19                   0  r[19]=orders.order_date
  26        Column         6   1  20                   0  r[20]=products.name
  27        Column         1   1  21                   0  r[21]=customers.name
  28        IdxRowId       3  22   0                   0  r[22]=cursor 3 for index idx_orders_customer_id.rowid
  29        Column         6   2  23                   0  r[23]=products.category
  30        MakeRecord    19   5   6                   0  r[6]=mkrec(r[19..23])
  31        SorterInsert   0   6   0  0                0  key=r[6]
  32      Next             5  19   0                   0
  33    Next               3  13   0                   0
  34  Next                 1   9   0                   0
  35  OpenPseudo           7   6   5                   0  5 columns in r[6]
  36  SorterSort           0  45   0                   0
  37    SorterData         0   6   7                   0  r[6]=data
  38    Column             7   2   1                   0  r[1]=pseudo.column 2
  39    Column             7   3   2                   0  r[2]=pseudo.column 3
  40    Column             7   0   3                   0  r[3]=pseudo.column 0
  41    Column             7   1   4                   0  r[4]=pseudo.column 1
  42    Column             7   4   5                   0  r[5]=pseudo.column 4
  43    ResultRow          1   5   0                   0  output=r[1..5]
  44  SorterNext           0  37   0                   0
  45  Halt                 0   0   0                   0
  46  Transaction          0   1  10                   0  iDb=0 tx_mode=Read
  47  String8              0   9   0  New York         0  r[9]='New York'
  48  String8              0  13   0  2024-01-01       0  r[13]='2024-01-01'
  49  Integer             50  18   0                   0  r[18]=50
  50  Goto                 0   1   0                   0
