---
source: modifications.sqltest
expression: |-
  INSERT INTO order_archive (id, user_id, product_id, quantity, total_price)
      SELECT id, user_id, product_id, quantity, total_price
      FROM orders
      WHERE created_at < '2024-01-01';
info:
  statement_type: INSERT
  tables:
  - order_archive
  - orders
  setup_blocks:
  - schema
  database: ':memory:'
---
QUERY PLAN
`--SCAN orders

BYTECODE
addr  opcode            p1  p2  p3  p4                         p5  comment
   0  Init               0  42   0                              0  Start at 42
   1  InitCoroutine      2  15   2                              0
   2  OpenRead           0   5   0  k(6,B,B,B,B,B,B)            0  table=orders, root=5, iDb=0
   3  Rewind             0  14   0                              0  Rewind table orders
   4    Column           0   5   9                              0  r[9]=orders.created_at
   5    Ge               9  10  13  Binary                      0  if r[9]>=r[10] goto 13
   6    RowId            0   3   0                              0  r[3]=orders.rowid
   7    Column           0   1   4                              0  r[4]=orders.user_id
   8    Column           0   2   5                              0  r[5]=orders.product_id
   9    Column           0   3   6                              0  r[6]=orders.quantity
  10    Column           0   4   7                              0  r[7]=orders.total_price
  11    RealAffinity     7   0   0                              0
  12    Yield            2   0   0                              0
  13  Next               0   4   0                              0
  14  EndCoroutine       2   0   0                              0
  15  OpenWrite          1   7   0                              0  root=7; iDb=0
  16    Yield            2  40   0                              0
  17    Copy             3  11   0                              0  r[11]=r[3]
  18    SoftNull        12   0   0                              0
  19    Copy             4  13   0                              0  r[13]=r[4]
  20    Copy             5  14   0                              0  r[14]=r[5]
  21    Copy             6  15   0                              0  r[15]=r[6]
  22    Copy             7  16   0                              0  r[16]=r[7]
  23    Null             0  17   0                              0  r[17]=NULL
  24    NotNull         11  26   0                              0  r[11]!=NULL -> goto 26
  25    Goto             0  28   0                              0
  26    MustBeInt       11   0   0                              0
  27    Goto             0  29   0                              0
  28    NewRowid         1  11   0                              0  r[11]=rowid
  29    Affinity        12   6   0                              0  r[12..18] = D, D, D, D, E, B
  30    NotExists        1  32  11                              0
  31    Halt          1555   0   0  order_archive.id            0
  32    HaltIfNull    1299   0  13  order_archive.user_id       0
  33    HaltIfNull    1299   0  14  order_archive.product_id    0
  34    HaltIfNull    1299   0  15  order_archive.quantity      0
  35    HaltIfNull    1299   0  16  order_archive.total_price   0
  36    MakeRecord      12   6  18                              0  r[18]=mkrec(r[12..17])
  37    Insert           1  18  11  order_archive               0  intkey=r[11] data=r[18]
  38    Goto             0  39   0                              0
  39  Goto               0  16   0                              0
  40  Goto               0  41   0                              0
  41  Halt               0   0   0                              0
  42  Transaction        0   2  10                              0  iDb=0 tx_mode=Write
  43  String8            0  10   0  2024-01-01                  0  r[10]='2024-01-01'
  44  Goto               0   1   0                              0
