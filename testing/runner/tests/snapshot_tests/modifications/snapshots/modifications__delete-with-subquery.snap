---
source: modifications.sqltest
expression: |-
  DELETE FROM orders
      WHERE user_id IN (
          SELECT id FROM users WHERE status = 'inactive'
      );
info:
  statement_type: DELETE
  tables:
  - orders
  - users
  setup_blocks:
  - schema
  database: ':memory:'
---
QUERY PLAN
|--LIST SUBQUERY 1
|  `--SCAN users
`--SCAN orders USING COVERING INDEX idx_orders_user_id

BYTECODE
addr  opcode          p1  p2  p3  p4            p5  comment
   0  Init             0  55   0                 0  Start at 55
   1  OpenWrite        1   5   0                 0  root=5; iDb=0
   2  OpenWrite        2  13   0                 0  root=13; iDb=0
   3  OpenWrite        3  12   0                 0  root=12; iDb=0
   4  Null             0   1   0                 0  r[1]=NULL
   5  Once            15   0   0                 0  goto 15
   6  OpenEphemeral    0   0   0                 0  cursor=0 is_table=false
   7  OpenRead         4   3   0  k(4,B,B,B,B)   0  table=users, root=3, iDb=0
   8  Rewind           4  15   0                 0  Rewind table users
   9    Column         4   3   4  active         0  r[4]=users.status
  10    Ne             4   5  14  Binary         0  if r[4]!=r[5] goto 14
  11    RowId          4   2   0                 0  r[2]=users.rowid
  12    MakeRecord     2   1   6                 0  r[6]=mkrec(r[2..2]); for ephemeral_index_where_sub_t2
  13    IdxInsert      0   6   0                 8  key=r[6]
  14  Next             4   9   0                 0
  15  OpenRead         5  12   0  k(2,B)         0  index=idx_orders_user_id, root=12, iDb=0
  16  Rewind           3  39   0                 0  Rewind index idx_orders_user_id
  17    DeferredSeek   3   1   0                 0
  18    Integer        0   8   0                 0  r[8]=0
  19    Column         3   0   9                 0  r[9]=idx_orders_user_id.user_id
  20    IsNull         9  24   0                 0  if (r[9]==NULL) goto 24
  21    Affinity       9   1   0                 0  r[9..10] = C
  22    NotFound       0  24   9                 0  if not found goto 24
  23    Goto           0  30   0                 0
  24    Rewind         0  32   0                 0  Rewind  ephemeral(ephemeral_index_where_sub_t2)
  25      Column       0   0  10                 0  r[10]=ephemeral(ephemeral_index_where_sub_t2).id
  26      Ne           9  10  28  Binary         0  if r[9]!=r[10] goto 28
  27      Goto         0  34   0                 0
  28    Next           0  25   0                 0
  29    Goto           0  32   0                 0
  30    Integer        1   8   0                 0  r[8]=1
  31    Goto           0  35   0                 0
  32    Integer        0   8   0                 0  r[8]=0
  33    Goto           0  35   0                 0
  34    Null           0   8   0                 0  r[8]=NULL
  35    IfNot          8  38   1                 0  if !r[8] goto 38
  36    IdxRowId       3   7   0                 0  r[7]=cursor 3 for index idx_orders_user_id.rowid
  37    RowSetAdd      1   7   0                 0
  38  Next             3  17   0                 0
  39  Close            1   0   0                 0
  40  OpenWrite        1   5   0                 0  root=5; iDb=0
  41  OpenWrite        6  13   0                 0  root=13; iDb=0
  42  OpenWrite        7  12   0                 0  root=12; iDb=0
  43    RowSetRead     1  54  11                 0
  44    NotExists      1  53  11                 0
  45    NotExists      1  53  11                 0
  46    Column         1   2  12                 0  r[12]=orders.product_id
  47    RowId          1  13   0                 0  r[13]=orders.rowid
  48    IdxDelete      2  12   2                 1
  49    Column         1   1  14                 0  r[14]=orders.user_id
  50    RowId          1  15   0                 0  r[15]=orders.rowid
  51    IdxDelete      3  14   2                 1
  52    Delete         1   0   0  orders         0
  53  Goto             0  43   0                 0
  54  Halt             0   0   0                 0
  55  Transaction      0   2  10                 0  iDb=0 tx_mode=Write
  56  String8          0   5   0  inactive       0  r[5]='inactive'
  57  Goto             0   1   0                 0
