---
source: subqueries.sqltest
expression: |-
  SELECT
          name,
          price,
          (SELECT max(price) FROM products) AS max_price
      FROM products
      WHERE price > 100;
info:
  statement_type: SELECT
  tables:
  - products
  setup_blocks:
  - schema
  database: ':memory:'
---
QUERY PLAN
|--SCALAR SUBQUERY 1
|  `--SCAN products
`--SCAN products

BYTECODE
addr  opcode             p1  p2  p3  p4              p5  comment
   0    Init              0  30   0                   0  Start at 30
   1    Once             18   0   0                   0  goto 18
   2    BeginSubrtn       2   0   0                   0  r[2]=NULL
   3    Null              0   1   0                   0  r[1]=NULL
   4    Null              0   4   0                   0  r[4]=NULL
   5    Integer           1   5   0                   0  r[5]=1; LIMIT counter
   6    IfNot             5  14   0                   0  if !r[5] goto 14
   7    OpenRead          0   2   0  k(5,B,B,B,B,B)   0  table=products, root=2, iDb=0
   8    Rewind            0  14   0                   0  Rewind table products
   9      Column          0   3   6                   0  r[6]=products.price
  10      RealAffinity    6   0   0                   0
  11      CollSeq         0   0   0  Binary           0  collation=Binary
  12      AggStep         0   6   4  max              0  accum=r[4] step(r[6])
  13    Next              0   9   0                   0
  14    AggFinal          0   4   0  max              0  accum=r[4]
  15    Copy              4   3   0                   0  r[3]=r[4]
  16    Copy              3   1   0                   0  r[1]=r[3]
  17  Return              2   0   1                   0
  18  OpenRead            1   2   0  k(5,B,B,B,B,B)   0  table=products, root=2, iDb=0
  19  Rewind              1  29   0                   0  Rewind table products
  20    Column            1   3  11                   0  r[11]=products.price
  21    RealAffinity     11   0   0                   0
  22    Le               11  12  28  Binary           0  if r[11]<=r[12] goto 28
  23    Column            1   1   7                   0  r[7]=products.name
  24    Column            1   3   8                   0  r[8]=products.price
  25    RealAffinity      8   0   0                   0
  26    Copy              1   9   0                   0  r[9]=r[1]
  27    ResultRow         7   3   0                   0  output=r[7..9]
  28  Next                1  20   0                   0
  29  Halt                0   0   0                   0
  30  Transaction         0   1  11                   0  iDb=0 tx_mode=Read
  31  Integer           100  12   0                   0  r[12]=100
  32  Goto                0   1   0                   0
