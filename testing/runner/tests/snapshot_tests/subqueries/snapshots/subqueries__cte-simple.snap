---
source: subqueries.sqltest
expression: "WITH high_value_products AS (\n        SELECT id, name, price\n        FROM products\n        WHERE price > 100\n    )\n    SELECT * FROM high_value_products\n    ORDER BY price DESC;"
info:
  statement_type: WITH (CTE)
  tables:
    - high_value_products
    - products
  setup_blocks:
    - schema
  database: ":memory:"
---
QUERY PLAN
|--SCAN high_value_products
|  `--SCAN products
`--USE TEMP B-TREE FOR ORDER BY

BYTECODE
addr  opcode           p1  p2  p3  p4              p5  comment
   0  Init              0  32   0                   0  Start at 32
   1  InitCoroutine     1  14   2                   0
   2  OpenRead          0   2   0  k(5,B,B,B,B,B)   0  table=products, root=2, iDb=0
   3  Rewind            0  13   0                   0  Rewind table products
   4    Column          0   3   6                   0  r[6]=products.price
   5    RealAffinity    6   0   0                   0
   6    Le              6   7  12  Binary           0  if r[6]<=r[7] goto 12
   7    RowId           0   2   0                   0  r[2]=products.rowid
   8    Column          0   1   3                   0  r[3]=products.name
   9    Column          0   3   4                   0  r[4]=products.price
  10    RealAffinity    4   0   0                   0
  11    Yield           1   0   0                   0
  12  Next              0   4   0                   0
  13  EndCoroutine      1   0   0                   0
  14  SorterOpen        1   1   0  k(1,-B)          0  cursor=1
  15  InitCoroutine     1   0   2                   0
  16    Yield           1  23   0                   0
  17    Copy            4  12   0                   0  r[12]=r[4]
  18    Copy            2  13   0                   0  r[13]=r[2]
  19    Copy            3  14   0                   0  r[14]=r[3]
  20    MakeRecord     12   3  11                   0  r[11]=mkrec(r[12..14])
  21    SorterInsert    1  11   0  0                0  key=r[11]
  22  Goto              0  16   0                   0
  23  OpenPseudo        2  11   3                   0  3 columns in r[11]
  24  SorterSort        1  31   0                   0
  25    SorterData      1  11   2                   0  r[11]=data
  26    Column          2   1   8                   0  r[8]=pseudo.column 1
  27    Column          2   2   9                   0  r[9]=pseudo.column 2
  28    Column          2   0  10                   0  r[10]=pseudo.column 0
  29    ResultRow       8   3   0                   0  output=r[8..10]
  30  SorterNext        1  25   0                   0
  31  Halt              0   0   0                   0
  32  Transaction       0   1  11                   0  iDb=0 tx_mode=Read
  33  Integer         100   7   0                   0  r[7]=100
  34  Goto              0   1   0                   0
