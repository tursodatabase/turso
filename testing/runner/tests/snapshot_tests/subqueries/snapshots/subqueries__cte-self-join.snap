---
source: subqueries.sqltest
expression: |-
  WITH employee_salaries AS (
          SELECT id, name, department, salary
          FROM employees
          WHERE salary IS NOT NULL
      )
      SELECT
          e1.name AS employee,
          e1.salary AS emp_salary,
          e2.name AS colleague,
          e2.salary AS col_salary
      FROM employee_salaries e1
      JOIN employee_salaries e2 ON e1.department = e2.department
          AND e1.id < e2.id
      WHERE e1.salary > e2.salary * 1.5;
info:
  statement_type: WITH (CTE)
  tables:
  - e1.department
  - employee_salaries
  - employees
  setup_blocks:
  - schema
  database: ':memory:'
---
QUERY PLAN
|--SCAN employees
|--SCAN employee_salaries AS e1
`--SEARCH e2 USING INDEX ephemeral_subquery_t4
