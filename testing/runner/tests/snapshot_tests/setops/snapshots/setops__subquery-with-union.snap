---
source: setops.sqltest
expression: "SELECT * FROM (\n        SELECT name, department FROM current_employees\n        UNION\n        SELECT name, department FROM former_employees\n    ) AS all_employees\n    WHERE department = 'Engineering';"
info:
  statement_type: SELECT
  tables:
    - current_employees
    - former_employees
  setup_blocks:
    - schema
  database: ":memory:"
---
QUERY PLAN
`--SCAN all_employees
   `--COMPOUND QUERY
      |--LEFT-MOST SUBQUERY
      |  `--SCAN current_employees
      `--UNION USING TEMP B-TREE
         `--SCAN former_employees

BYTECODE
addr  opcode         p1  p2  p3  p4              p5  comment
   0  Init            0  33   0                   0  Start at 33
   1  InitCoroutine   1  24   2                   0
   2  OpenEphemeral   0   0   0                   0  cursor=0 is_table=false
   3  OpenRead        1   2   0  k(4,B,B,B,B)     0  table=current_employees, root=2, iDb=0
   4  Rewind          1  10   0                   0  Rewind table current_employees
   5    Column        1   1   2                   0  r[2]=current_employees.name
   6    Column        1   2   3                   0  r[3]=current_employees.department
   7    MakeRecord    2   2   4                   0  r[4]=mkrec(r[2..3]); for compound_dedupe
   8    IdxInsert     0   4   0                   8  key=r[4]
   9  Next            1   5   0                   0
  10  OpenRead        2   3   0  k(5,B,B,B,B,B)   0  table=former_employees, root=3, iDb=0
  11  Rewind          2  17   0                   0  Rewind table former_employees
  12    Column        2   1   2                   0  r[2]=former_employees.name
  13    Column        2   2   3                   0  r[3]=former_employees.department
  14    MakeRecord    2   2   5                   0  r[5]=mkrec(r[2..3]); for compound_dedupe
  15    IdxInsert     0   5   0                   8  key=r[5]
  16  Next            2  12   0                   0
  17  Rewind          0  21   0                   0  Rewind  compound_dedupe
  18    Column        0   0   2                   0  r[2]=compound_dedupe.name
  19    Column        0   1   3                   0  r[3]=compound_dedupe.department
  20    Yield         1   0   0                   0
  21  Next            0  18   0                   0
  22  Close           0   0   0                   0
  23  EndCoroutine    1   0   0                   0
  24  InitCoroutine   1   0   2                   0
  25    Yield         1  32   0                   0
  26    Copy          3   9   0                   0  r[9]=r[3]
  27    Ne            9  10  31  Binary           0  if r[9]!=r[10] goto 31
  28    Copy          2   6   0                   0  r[6]=r[2]
  29    Copy          3   7   0                   0  r[7]=r[3]
  30    ResultRow     6   2   0                   0  output=r[6..7]
  31  Goto            0  25   0                   0
  32  Halt            0   0   0                   0
  33  Transaction     0   1   6                   0  iDb=0 tx_mode=Read
  34  String8         0  10   0  Engineering      0  r[10]='Engineering'
  35  Goto            0   1   0                   0
