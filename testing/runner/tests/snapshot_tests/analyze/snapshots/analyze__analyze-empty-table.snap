---
source: analyze.sqltest
expression: ANALYZE products;
info:
  statement_type: OTHER
  setup_blocks:
  - schema
  database: ':memory:'
---
QUERY PLAN


BYTECODE
addr  opcode       p1  p2  p3  p4                                               p5  comment
   0  Init          0  93   0                                                    0  Start at 93
   1  Null          0   1   0                                                    0  r[1]=NULL
   2  CreateBtree   0   2   1                                                    0  r[2]=root iDb=0 flags=1
   3  OpenWrite     0   1   0                                                    0  root=1; iDb=0
   4  NewRowid      0   3   0                                                    0  r[3]=rowid
   5  String8       0   4   0  table                                             0  r[4]='table'
   6  String8       0   5   0  sqlite_stat1                                      0  r[5]='sqlite_stat1'
   7  String8       0   6   0  sqlite_stat1                                      0  r[6]='sqlite_stat1'
   8  Copy          2   7   0                                                    0  r[7]=r[2]
   9  String8       0   8   0  CREATE TABLE sqlite_stat1(tbl,idx,stat)           0  r[8]='CREATE TABLE sqlite_stat1(tbl,idx,stat)'
  10  MakeRecord    4   5   9                                                    0  r[9]=mkrec(r[4..8])
  11  Insert        0   9   3  sqlite_stat1                                      0  intkey=r[3] data=r[9]
  12  ParseSchema   0   0   0  tbl_name = 'sqlite_stat1' AND type != 'trigger'   0  tbl_name = 'sqlite_stat1' AND type != 'trigger'
  13  SetCookie     0   1  10                                                    0
  14  OpenWrite     1   2   0                                                    0  root=2; iDb=0
  15  Rewind        1  22   0                                                    0  Rewind  sqlite_stat1
  16      Column    1   0  10                                                    0  r[10]=sqlite_stat1.tbl
  17      Ne       10  11  21                                                    0  if r[10]!=r[11] goto 21
  18      RowId     1  12   0                                                    0  r[12]=sqlite_stat1.rowid
  19      Delete    1   0   0  sqlite_stat1                                      0
  20    Next        1  16   0                                                    0
  21  Next          1  16   0                                                    0
  22  OpenRead      2   2   0  k(6,B,B,B,B,B,B)                                  0  =products, root=2, iDb=0
  23  Count         2  18   0                                                    0
  24  IfNot        18  31   0                                                    0  if !r[18] goto 31
  25  Null          0  15   0                                                    0  r[15]=NULL
  26  Copy         18  16   0                                                    0  r[16]=r[18]
  27  Cast         16   0   0                                                    0  affinity(r[16]=Text)
  28  MakeRecord   14   3  17                                                    0  r[17]=mkrec(r[14..16])
  29  NewRowid      1  13   0                                                    0  r[13]=rowid
  30  Insert        1  17  13  sqlite_stat1                                      0  intkey=r[13] data=r[17]
  31  OpenRead      3   5   0  k(2,B)                                            0  =idx_products_price, root=5, iDb=0
  32  Integer       1  20   0                                                    0  r[20]=1
  33  Function      0  20  19  stat_init                                         0  r[19]=func(r[20])
  34  Rewind        3  51   0                                                    0  Rewind  idx_products_price
  35  Integer       0  20   0                                                    0  r[20]=0
  36  Goto          0  42   0                                                    0
  37    Integer     0  20   0                                                    0  r[20]=0
  38    Column      3   0  22                                                    0  r[22]=idx_products_price.price
  39    Ne         22  21  42                                                    0  if r[22]!=r[21] goto 42
  40    Integer     1  20   0                                                    0  r[20]=1
  41    Goto        0  43   0                                                    0
  42    Column      3   0  21                                                    0  r[21]=idx_products_price.price
  43    Function    0  19  19  stat_push                                         0  r[19]=func(r[19..20])
  44  Next          3  37   0                                                    0
  45  Function      0  19  23  stat_get                                          0  r[23]=func(r[19])
  46  IsNull       23  51   0                                                    0  if (r[23]==NULL) goto 51
  47  Copy         23  26   0                                                    0  r[26]=r[23]
  48  MakeRecord   24   3  27                                                    0  r[27]=mkrec(r[24..26])
  49  NewRowid      1  28   0                                                    0  r[28]=rowid
  50  Insert        1  27  28  sqlite_stat1                                      0  intkey=r[28] data=r[27]
  51  OpenRead      4   4   0  k(2,B)                                            0  =idx_products_category, root=4, iDb=0
  52  Integer       1  30   0                                                    0  r[30]=1
  53  Function      0  30  29  stat_init                                         0  r[29]=func(r[30])
  54  Rewind        4  71   0                                                    0  Rewind  idx_products_category
  55  Integer       0  30   0                                                    0  r[30]=0
  56  Goto          0  62   0                                                    0
  57    Integer     0  30   0                                                    0  r[30]=0
  58    Column      4   0  32                                                    0  r[32]=idx_products_category.category
  59    Ne         32  31  62                                                    0  if r[32]!=r[31] goto 62
  60    Integer     1  30   0                                                    0  r[30]=1
  61    Goto        0  63   0                                                    0
  62    Column      4   0  31                                                    0  r[31]=idx_products_category.category
  63    Function    0  29  29  stat_push                                         0  r[29]=func(r[29..30])
  64  Next          4  57   0                                                    0
  65  Function      0  29  33  stat_get                                          0  r[33]=func(r[29])
  66  IsNull       33  71   0                                                    0  if (r[33]==NULL) goto 71
  67  Copy         33  36   0                                                    0  r[36]=r[33]
  68  MakeRecord   34   3  37                                                    0  r[37]=mkrec(r[34..36])
  69  NewRowid      1  38   0                                                    0  r[38]=rowid
  70  Insert        1  37  38  sqlite_stat1                                      0  intkey=r[38] data=r[37]
  71  OpenRead      5   3   0  k(2,B)                                            0  =idx_products_sku, root=3, iDb=0
  72  Integer       1  40   0                                                    0  r[40]=1
  73  Function      0  40  39  stat_init                                         0  r[39]=func(r[40])
  74  Rewind        5  91   0                                                    0  Rewind  idx_products_sku
  75  Integer       0  40   0                                                    0  r[40]=0
  76  Goto          0  82   0                                                    0
  77    Integer     0  40   0                                                    0  r[40]=0
  78    Column      5   0  42                                                    0  r[42]=idx_products_sku.sku
  79    Ne         42  41  82                                                    0  if r[42]!=r[41] goto 82
  80    Integer     1  40   0                                                    0  r[40]=1
  81    Goto        0  83   0                                                    0
  82    Column      5   0  41                                                    0  r[41]=idx_products_sku.sku
  83    Function    0  39  39  stat_push                                         0  r[39]=func(r[39..40])
  84  Next          5  77   0                                                    0
  85  Function      0  39  43  stat_get                                          0  r[43]=func(r[39])
  86  IsNull       43  91   0                                                    0  if (r[43]==NULL) goto 91
  87  Copy         43  46   0                                                    0  r[46]=r[43]
  88  MakeRecord   44   3  47                                                    0  r[47]=mkrec(r[44..46])
  89  NewRowid      1  48   0                                                    0  r[48]=rowid
  90  Insert        1  47  48  sqlite_stat1                                      0  intkey=r[48] data=r[47]
  91  Expire        0   0   0                                                    0
  92  Halt          0   0   0                                                    0
  93  Transaction   0   2   9                                                    0  iDb=0 tx_mode=Write
  94  String8       0  11   0  products                                          0  r[11]='products'
  95  String8       0  14   0  products                                          0  r[14]='products'
  96  String8       0  24   0  products                                          0  r[24]='products'
  97  String8       0  25   0  idx_products_price                                0  r[25]='idx_products_price'
  98  String8       0  34   0  products                                          0  r[34]='products'
  99  String8       0  35   0  idx_products_category                             0  r[35]='idx_products_category'
 100  String8       0  44   0  products                                          0  r[44]='products'
 101  String8       0  45   0  idx_products_sku                                  0  r[45]='idx_products_sku'
 102  Goto          0   1   0                                                    0
