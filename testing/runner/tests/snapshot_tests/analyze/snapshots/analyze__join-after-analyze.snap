---
source: analyze.sqltest
expression: |-
  SELECT c.name, p.amount
      FROM customers c
      JOIN purchases p ON c.id = p.customer_id
      WHERE c.id = 2;
info:
  statement_type: SELECT
  tables:
  - c.id
  - customers
  - purchases
  setup_blocks:
  - join_tables
  database: ':memory:'
---
QUERY PLAN
|--SCAN customers AS c
`--SEARCH p USING INDEX ephemeral_purchases_t2

BYTECODE
addr  opcode            p1  p2  p3  p4          p5  comment
   0  Init               0  31   0               0  Start at 31
   1  OpenRead           0   2   0  k(2,B,B)     0  table=customers, root=2, iDb=0
   2  OpenRead           1   3   0  k(3,B,B,B)   0  table=purchases, root=3, iDb=0
   3  Rewind             0  30   0               0  Rewind table customers
   4    RowId            0   4   0               0  r[4]=customers.rowid
   5    Ne               4   5  29  Binary       0  if r[4]!=r[5] goto 29
   6    Once            16   0   0               0  goto 16
   7    OpenAutoindex    2   0   0               0  cursor=2
   8    Rewind           1   9   0               0  Rewind table purchases
   9      Column         1   1   6               0  r[6]=purchases.customer_id
  10      Column         1   2   7               0  r[7]=purchases.amount
  11      RowId          1   8   0               0  r[8]=purchases.rowid
  12      MakeRecord     6   3   9               0  r[9]=mkrec(r[6..8]); for ephemeral_purchases_t2
  13      FilterAdd      2   6   1               0  bloom_filter_add(r[6..7])
  14      IdxInsert      2   9   6               0  key=r[9]
  15    Next             1   9   0               0
  16    RowId            0  10   0               0  r[10]=customers.rowid
  17    Filter           2  29  10               1  if !bloom_filter(r[10..11]) goto 29
  18    SeekGE           2  29  10               0  key=[10..10]
  19      IdxGT          2  29  10               0  key=[10..10]
  20      DeferredSeek   2   1   0               0
  21      RowId          0  12   0               0  r[12]=customers.rowid
  22      Column         2   0  13               0  r[13]=ephemeral(ephemeral_purchases_t2).customer_id
  23      Ne            12  13  28  Binary       0  if r[12]!=r[13] goto 28
  24      Column         0   1   1               0  r[1]=customers.name
  25      Column         2   1   2               0  r[2]=ephemeral(ephemeral_purchases_t2).amount
  26      RealAffinity   2   0   0               0
  27      ResultRow      1   2   0               0  output=r[1..2]
  28    Next             2  19   0               0
  29  Next               0   4   0               0
  30  Halt               0   0   0               0
  31  Transaction        0   1   4               0  iDb=0 tx_mode=Read
  32  Integer            2   5   0               0  r[5]=2
  33  Goto               0   1   0               0
