@database :default:
@database :default-no-rowidalias:

# Test format() as an alias for printf()
# format() was added in SQLite 3.38.0 as an alias for printf()

# Basic string formatting
test format-basic-string {
    SELECT format('Hello World!');
}
expect {
    Hello World!
}

test format-string-replacement {
    SELECT format('Hello, %s', 'Alice');
}
expect {
    Hello, Alice
}

test format-string-substitution {
    SELECT format('Hello, %s!', 'World');
}
expect {
    Hello, World!
}

test format-multiple-strings {
    SELECT format('%s %s!', 'Hello', 'World');
}
expect {
    Hello World!
}

test format-null-string {
    SELECT format('Hello, %s!', NULL);
}
expect {
    Hello, !
}

test format-integer-as-string {
    SELECT format('Value: %s', 42);
}
expect {
    Value: 42
}

test format-percent-escape {
    SELECT format('100%% complete');
}
expect {
    100% complete
}

# Integer formatting
test format-integer-replacement {
    SELECT format('Number: %d', 42);
}
expect {
    Number: 42
}

test format-integer-negative {
    SELECT format('Number: %d', -42);
}
expect {
    Number: -42
}

test format-integer-arithmetic-expression {
    SELECT format('%d + %d = %d', 2, 3, 5);
}
expect {
    2 + 3 = 5
}

test format-text-as-integer {
    SELECT format('Number: %d', 'not a number');
}
expect {
    Number: 0
}

# Unsigned integer formatting
test format-unsigned-basic {
    SELECT format('Number: %u', 42);
}
expect {
    Number: 42
}

test format-unsigned-arithmetic-expression {
    SELECT format('%u + %u = %u', 2, 3, 5);
}
expect {
    2 + 3 = 5
}

test format-unsigned-negative {
    SELECT format('Negative: %u', -1);
}
expect {
    Negative: 18446744073709551615
}

test format-text-as-unsigned {
    SELECT format('NaN: %u', 'not a number');
}
expect {
    NaN: 0
}

# Float formatting
test format-float-basic {
    SELECT format('Number: %f', 42.5);
}
expect {
    Number: 42.500000
}

test format-float-negative {
    SELECT format('Number: %f', -42.5);
}
expect {
    Number: -42.500000
}

test format-integer-as-float {
    SELECT format('Number: %f', 42);
}
expect {
    Number: 42.000000
}

test format-float-arithmetic {
    SELECT format('%f + %f = %f', 2.5, 3.5, 6.0);
}
expect {
    2.500000 + 3.500000 = 6.000000
}

test format-text-as-float {
    SELECT format('Number: %f', 'not a number');
}
expect {
    Number: 0.000000
}

# Character formatting
test format-char-single {
    SELECT format('character: %c', 'a');
}
expect {
    character: a
}

test format-char-first-from-string {
    SELECT format('character: %c', 'this is a test');
}
expect {
    character: t
}

test format-char-empty-string {
    SELECT format('character: %c', '');
}
expect raw {
character: 
}

test format-char-from-integer {
    SELECT format('character: %c', 123);
}
expect {
    character: 1
}

test format-char-from-float {
    SELECT format('character: %c', 42.5);
}
expect {
    character: 4
}

# Exponential notation formatting
test format-exp-large-number {
    SELECT format('Exp: %e', 23000000.0);
}
expect {
    Exp: 2.300000e+07
}

test format-exp-negative-large {
    SELECT format('Exp: %e', -23000000.0);
}
expect {
    Exp: -2.300000e+07
}

test format-exp-decimal-float {
    SELECT format('Exp: %e', 250.375);
}
expect {
    Exp: 2.503750e+02
}

test format-exp-small-positive {
    SELECT format('Exp: %e', 0.0003235);
}
expect {
    Exp: 3.235000e-04
}

test format-exp-zero {
    SELECT format('Exp: %e', 0.0);
}
expect {
    Exp: 0.000000e+00
}

test format-exp-string-integer {
    SELECT format('Exp: %e', '123');
}
expect {
    Exp: 1.230000e+02
}

test format-exp-string-float {
    SELECT format('Exp: %e', '123.45');
}
expect {
    Exp: 1.234500e+02
}

test format-exp-string-text {
    SELECT format('Exp: %e', 'test');
}
expect {
    Exp: 0.000000e+00
}

# Hexadecimal formatting
test format-hex-simple {
    SELECT format('hex: %x', 4);
}
expect {
    hex: 4
}

test format-hex-large-number {
    SELECT format('hex: %x', 15565303546);
}
expect {
    hex: 39fc3aefa
}

test format-hex-uppercase {
    SELECT format('hex: %X', 15565303546);
}
expect {
    hex: 39FC3AEFA
}

test format-hex-negative {
    SELECT format('hex: %x', -15565303546);
}
expect {
    hex: fffffffc603c5106
}

test format-hex-float {
    SELECT format('hex: %x', 42.5);
}
expect {
    hex: 2a
}

# Octal formatting
test format-octal-simple {
    SELECT format('octal: %o', 4);
}
expect {
    octal: 4
}

test format-octal-large-number {
    SELECT format('octal: %o', 15565303546);
}
expect {
    octal: 163760727372
}

test format-octal-negative {
    SELECT format('octal: %o', -15565303546);
}
expect {
    octal: 1777777777614017050406
}

test format-octal-float {
    SELECT format('octal: %o', 42.5);
}
expect {
    octal: 52
}

# Mixed formatting
test format-mixed-string-integer {
    SELECT format('%s: %d', 'Count', 42);
}
expect {
    Count: 42
}

test format-mixed-all-types {
    SELECT format('%s: %d (%f%%)', 'Progress', 75, 75.5);
}
expect {
    Progress: 75 (75.500000%)
}

test format-mixed-complex-format {
    SELECT format('Name: %s, ID: %d, Score: %f', 'John', 123, 95.5);
}
expect {
    Name: John, ID: 123, Score: 95.500000
}

test format-mixed-string-exponential {
    SELECT format('Scientific: %s = %e', 'Large number', 123000.0);
}
expect {
    Scientific: Large number = 1.230000e+05
}

test format-mixed-integer-octal {
    SELECT format('Decimal %d is octal %o', 64, 64);
}
expect {
    Decimal 64 is octal 100
}

test format-mixed-exponential-float {
    SELECT format('Scientific %e equals %f', 0.00123, 0.00123);
}
expect {
    Scientific 1.230000e-03 equals 0.001230
}

test format-mixed-octal-hex {
    SELECT format('Octal %o is hex %x', 255, 255);
}
expect {
    Octal 377 is hex ff
}

# Verify format() and printf() produce identical results
test format-equals-printf-string {
    SELECT format('Hello, %s!', 'World') = printf('Hello, %s!', 'World');
}
expect {
    1
}

test format-equals-printf-integer {
    SELECT format('Number: %d', 42) = printf('Number: %d', 42);
}
expect {
    1
}

test format-equals-printf-float {
    SELECT format('Value: %f', 3.14159) = printf('Value: %f', 3.14159);
}
expect {
    1
}

test format-equals-printf-mixed {
    SELECT format('%s: %d (%f)', 'Test', 123, 45.67) = printf('%s: %d (%f)', 'Test', 123, 45.67);
}
expect {
    1
}

test format-equals-printf-hex {
    SELECT format('0x%X', 255) = printf('0x%X', 255);
}
expect {
    1
}

