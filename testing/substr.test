#!/usr/bin/env tclsh
set testdir [file dirname $argv0]
source $testdir/tester.tcl
source $testdir/sqlite3/tester.tcl

#***********************************************************************
# basically this is https://github.com/sqlite/sqlite/blob/master/test/substr.test


do_execsql_test_on_specific_db {:memory:} substr-1.1 { SELECT substr('abcdefg', 1, 1) } {a}
do_execsql_test_on_specific_db {:memory:} substr-1.2 { SELECT substr('abcdefg', 2, 1) } {b}
do_execsql_test_on_specific_db {:memory:} substr-1.3 { SELECT substr('abcdefg', 1, 2) } {ab}
do_execsql_test_on_specific_db {:memory:} substr-1.4 { SELECT substr('abcdefg', 1, 100) } {abcdefg}
do_execsql_test_on_specific_db {:memory:} substr-1.5 { SELECT substr('abcdefg', 0, 2) } {a}
do_execsql_test_on_specific_db {:memory:} substr-1.6 { SELECT substr('abcdefg', -1, 1) } {g}
do_execsql_test_on_specific_db {:memory:} substr-1.7 { SELECT substr('abcdefg', -1, 10) } {g}
do_execsql_test_on_specific_db {:memory:} substr-1.8 { SELECT substr('abcdefg', -5, 3) } {cde}
do_execsql_test_on_specific_db {:memory:} substr-1.9 { SELECT substr('abcdefg', -7, 3) } {abc}
do_execsql_test_on_specific_db {:memory:} substr-1.10 { SELECT substr('abcdefg', -100, 98) } {abcde}
do_execsql_test_on_specific_db {:memory:} substr-1.11 { SELECT substr('abcdefg', 5, -1) } {d}
do_execsql_test_on_specific_db {:memory:} substr-1.12 { SELECT substr('abcdefg', 5, -4) } {abcd}
do_execsql_test_on_specific_db {:memory:} substr-1.13 { SELECT substr('abcdefg', 5, -5) } {abcd}
do_execsql_test_on_specific_db {:memory:} substr-1.14 { SELECT substr('abcdefg', -5, -1) } {b}
do_execsql_test_on_specific_db {:memory:} substr-1.15 { SELECT substr('abcdefg', -5, -2) } {ab}
do_execsql_test_on_specific_db {:memory:} substr-1.16 { SELECT substr('abcdefg', -5, -3) } {ab}
do_execsql_test_on_specific_db {:memory:} substr-1.17 { SELECT substr('abcdefg', 100, 200) } {}
do_execsql_test_on_specific_db {:memory:} substr-1.18 { SELECT substr('abcdefg', 200, 100) } {}


do_execsql_test_on_specific_db {:memory:} substr-1.90 { SELECT ifnull(substr(NULL,1,1),'nil') } {nil}
do_execsql_test_on_specific_db {:memory:} substr-1.91 { SELECT ifnull(substr(NULL,1),'nil') } {nil}
do_execsql_test_on_specific_db {:memory:} substr-1.92 { SELECT ifnull(substr('abcdefg',NULL,1),'nil') } {nil}
do_execsql_test_on_specific_db {:memory:} substr-1.93 { SELECT ifnull(substring('abcdefg',NULL),'nil') } {nil}
do_execsql_test_on_specific_db {:memory:} substr-1.94 { SELECT ifnull(substr('abcdefg',1,NULL),'nil') } {nil}


do_execsql_test_on_specific_db {:memory:} substr-2.1 { SELECT substr('\u1234\u2345\u3456', 1, 1) } "\u1234"
do_execsql_test_on_specific_db {:memory:} substr-2.2 { SELECT substr('\u1234\u2345\u3456', 2, 1) } "\u2345"
do_execsql_test_on_specific_db {:memory:} substr-2.3 { SELECT substr('\u1234\u2345\u3456', 1, 2) } "\u1234\u2345"
do_execsql_test_on_specific_db {:memory:} substr-2.4 { SELECT substr('\u1234\u2345\u3456', -1, 1) } "\u3456"
do_execsql_test_on_specific_db {:memory:} substr-2.5 { SELECT substr('a\u1234b\u2345c\u3456c', -5, 3) } "b\u2345c"
do_execsql_test_on_specific_db {:memory:} substr-2.6 { SELECT substr('a\u1234b\u2345c\u3456c', -2, -3) } "b\u2345c"


do_execsql_test_on_specific_db {:memory:} substr-3.1 { SELECT hex(substr(x'61626364656667', 1, 1)) } {61}
do_execsql_test_on_specific_db {:memory:} substr-3.2 { SELECT hex(substr(x'61626364656667', 2, 1)) } {62}
do_execsql_test_on_specific_db {:memory:} substr-3.3 { SELECT hex(substr(x'61626364656667', 1, 2)) } {6162}
do_execsql_test_on_specific_db {:memory:} substr-3.4 { SELECT hex(substr(x'61626364656667', 1, 100)) } {61626364656667}
do_execsql_test_on_specific_db {:memory:} substr-3.5 { SELECT hex(substr(x'61626364656667', 0, 2)) } {61}
do_execsql_test_on_specific_db {:memory:} substr-3.6 { SELECT hex(substr(x'61626364656667', -1, 1)) } {67}
do_execsql_test_on_specific_db {:memory:} substr-3.7 { SELECT hex(substr(x'61626364656667', -1, 10)) } {67}
do_execsql_test_on_specific_db {:memory:} substr-3.8 { SELECT hex(substr(x'61626364656667', -5, 3)) } {636465}
do_execsql_test_on_specific_db {:memory:} substr-3.9 { SELECT hex(substr(x'61626364656667', -7, 3)) } {616263}
do_execsql_test_on_specific_db {:memory:} substr-3.10 { SELECT hex(substr(x'61626364656667', -100, 98)) } {6162636465}
do_execsql_test_on_specific_db {:memory:} substr-3.11 { SELECT hex(substr(x'61626364656667', 100, 200)) } {}
do_execsql_test_on_specific_db {:memory:} substr-3.12 { SELECT hex(substr(x'61626364656667', 200, 100)) } {}

do_execsql_test_on_specific_db {:memory:} substr-4.1 { SELECT hex(substr(x'61E188B462E28D8563E3919663', 1, 1)) } {61}
do_execsql_test_on_specific_db {:memory:} substr-4.2 { SELECT hex(substr(x'61E188B462E28D8563E3919663', 2, 1)) } {E1}
do_execsql_test_on_specific_db {:memory:} substr-4.3 { SELECT hex(substr(x'61E188B462E28D8563E3919663', 1, 2)) } {61E1}
do_execsql_test_on_specific_db {:memory:} substr-4.4 { SELECT hex(substr(x'61E188B462E28D8563E3919663', -2, 1)) } {96}
do_execsql_test_on_specific_db {:memory:} substr-4.5 { SELECT hex(substr(x'61E188B462E28D8563E3919663', -5, 4)) } {63E39196}
do_execsql_test_on_specific_db {:memory:} substr-4.6 { SELECT hex(substr(x'61E188B462E28D8563E3919663', -100, 98)) } {61E188B462E28D8563E391}


do_execsql_test_on_specific_db {:memory:} substr-5.1 { SELECT substr('abcdefghijklmnop', 5) } {efghijklmnop}
do_execsql_test_on_specific_db {:memory:} substr-5.2 { SELECT substr('abcdef', -5) } {bcdef}
